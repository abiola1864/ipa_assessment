<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IPA Technical Assessment Quiz</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f5f5f5;
            line-height: 1.6;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }

        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            padding: 40px;
            margin-bottom: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .logo-section {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 30px;
        }

        .ipa-logo {
            max-width: 220px;
            height: auto;
            filter: drop-shadow(0 2px 10px rgba(0,0,0,0.1));
        }

        .header h1 {
            color: #11853d;
            font-size: 2.8em;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .header .subtitle {
            color: #666;
            font-size: 1.2em;
            margin-bottom: 10px;
            font-weight: 500;
        }

        .organization-info {
            background: linear-gradient(135deg, #f8fffe 0%, #e8f5f0 100%);
            border-left: 5px solid #11853d;
            padding: 25px;
            margin-bottom: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(17, 133, 61, 0.1);
        }

        .organization-info h4 {
            color: #11853d;
            margin-bottom: 12px;
            font-size: 1.2em;
            font-weight: 600;
        }

        .organization-info p {
            color: #555;
            font-size: 15px;
            margin: 0;
            line-height: 1.7;
        }

        .timer {
            background: #ff4444;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 1.2em;
            font-weight: bold;
            float: right;
            box-shadow: 0 2px 10px rgba(255, 68, 68, 0.3);
        }

        .progress-bar {
            width: 100%;
            height: 12px;
            background: #e0e0e0;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #11853d 0%, #16a852 100%);
            border-radius: 6px;
            transition: width 0.3s ease;
        }

        .question-info {
            color: #666;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .question {
            font-size: 1.2em;
            margin-bottom: 30px;
            line-height: 1.7;
            white-space: pre-line;
            color: #333;
        }

        .options {
            list-style: none;
            margin-bottom: 30px;
        }

        .option {
            margin-bottom: 15px;
            padding: 18px;
            border: 2px solid #ddd;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }

        .option:hover {
            border-color: #11853d;
            background: #f8fffe;
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(17, 133, 61, 0.1);
        }

        .option.selected {
            border-color: #11853d;
            background: linear-gradient(135deg, #f8fffe 0%, #e8f5f0 100%);
            box-shadow: 0 4px 15px rgba(17, 133, 61, 0.2);
        }

        .option input[type="radio"] {
            margin-right: 12px;
            transform: scale(1.2);
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 30px;
        }

        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary {
            background: linear-gradient(135deg, #11853d 0%, #16a852 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(17, 133, 61, 0.3);
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(17, 133, 61, 0.4);
        }

        .btn-secondary {
            background: #666;
            color: white;
        }

        .btn-secondary:hover:not(:disabled) {
            background: #555;
            transform: translateY(-1px);
        }

        .btn-danger {
            background: #ff4444;
            color: white;
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .question-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-top: 20px;
            justify-content: center;
        }

        .question-number {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-weight: bold;
            border: 2px solid #ddd;
            background: white;
            transition: all 0.3s ease;
        }

        .question-number:hover {
            transform: scale(1.1);
        }

        .question-number.answered {
            background: #11853d;
            color: white;
            border-color: #11853d;
        }

        .question-number.current {
            background: #2196F3;
            color: white;
            border-color: #2196F3;
            transform: scale(1.15);
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #11853d;
        }

        .form-group input {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus {
            outline: none;
            border-color: #11853d;
            box-shadow: 0 0 0 3px rgba(17, 133, 61, 0.1);
        }

        .quiz-info {
            background: linear-gradient(135deg, #e3f2fd 0%, #f8fbff 100%);
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
            border: 1px solid #e1f5fe;
        }

        .quiz-info h3 {
            color: #1976d2;
            margin-bottom: 20px;
            font-size: 1.3em;
            font-weight: 600;
        }

        .quiz-info ul {
            margin-left: 20px;
        }

        .quiz-info li {
            margin-bottom: 10px;
            color: #1976d2;
            font-weight: 500;
        }

        .completion-card {
            text-align: center;
            padding: 50px;
        }

        .completion-icon {
            font-size: 5em;
            margin-bottom: 25px;
        }

        .score-display {
            background: linear-gradient(135deg, #f5f5f5 0%, #fff 100%);
            padding: 40px;
            border-radius: 15px;
            margin: 25px 0;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .score-number {
            font-size: 3.5em;
            font-weight: bold;
            color: #11853d;
        }

        .grade-badge {
            padding: 12px 24px;
            border-radius: 25px;
            color: white;
            font-weight: bold;
            margin-top: 15px;
            display: inline-block;
            font-size: 1.1em;
        }

        .excellent { background: linear-gradient(135deg, #11853d 0%, #16a852 100%); }
        .good { background: linear-gradient(135deg, #FF9800 0%, #FFC107 100%); }
        .needs-improvement { background: linear-gradient(135deg, #f44336 0%, #e57373 100%); }

        .validation-error {
            background: #ffebee;
            color: #c62828;
            padding: 18px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #f44336;
            font-weight: 500;
        }

        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #11853d;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .submission-status {
            background: #e8f5e8;
            color: #2e7d2e;
            padding: 18px;
            border-radius: 8px;
            margin-top: 20px;
            border-left: 4px solid #11853d;
        }

        .detailed-results {
            text-align: left;
            margin-top: 30px;
            padding: 25px;
            background: #f9f9f9;
            border-radius: 12px;
        }

        .result-question {
            margin-bottom: 25px;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #ddd;
        }

        .result-question.correct {
            background: #e8f5e8;
            border-left-color: #11853d;
        }

        .result-question.incorrect {
            background: #ffebee;
            border-left-color: #f44336;
        }

        .result-question h4 {
            margin-bottom: 12px;
            color: #333;
            font-weight: 600;
        }

        .result-details {
            font-size: 14px;
            margin-top: 10px;
        }

        .your-answer {
            color: #f44336;
            font-weight: bold;
        }

        .correct-answer {
            color: #11853d;
            font-weight: bold;
        }

        .explanation {
            background: #f0f0f0;
            padding: 12px;
            border-radius: 6px;
            margin-top: 10px;
            font-style: italic;
            line-height: 1.5;
        }

        .hidden {
            display: none;
        }

        .footer-logos {
            text-align: center;
            margin-top: 50px;
            padding-top: 30px;
            border-top: 1px solid #eee;
        }

        .footer-logos p {
            color: #666;
            font-size: 14px;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .card {
                padding: 25px;
            }
            
            .timer {
                float: none;
                display: block;
                text-align: center;
                margin-bottom: 20px;
            }
            
            .question-grid {
                justify-content: center;
            }

            .ipa-logo {
                max-width: 180px;
            }

            .header h1 {
                font-size: 2.2em;
            }

            .organization-info {
                padding: 20px;
            }

            .quiz-info {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Start Screen -->
        <div id="startScreen" class="card">
            <div class="header">
            <!-- Logo Section -->
<!-- Logo Section -->
<div class="logo-section">
    <!-- IPA Logo -->
   <img src="images/ipalogo.png" 
     alt="IPA - Innovations for Poverty Action" 
     class="ipa-logo">

</div>



                <h1>Technical Assessment</h1>
                <p class="subtitle">Innovations for Poverty Action</p>
            </div>

            <!-- Organization Information -->
            <div class="organization-info">
                <h4>Assessment Overview</h4>
                <p>This technical assessment evaluates expertise in data analysis, monitoring & evaluation, impact evaluation methodology, and programming logic for evidence-based research and policy implementation.</p>
            </div>

            <div class="quiz-info">
                <h3>Assessment Information:</h3>
                <ul>
                    <li>20 Multiple Choice Questions</li>
                    <li>35 Minutes Time Limit</li>
                    <li>40% Data Analysis, 25% M&E/Impact Evaluation, 35% Programming Logic</li>
                    <li>Tests expertise in research methodology and implementation</li>
                    <li>Covers statistical analysis, evaluation design, and technical problem-solving</li>
                    <li>All questions are required</li>
                    <li>Detailed results with explanations provided at the end</li>
                    <li>You can move between questions before submitting</li>
                </ul>
            </div>

            <div class="form-group">
                <label for="participantName">Your Full Name:</label>
                <input type="text" id="participantName" placeholder="Enter your full name" maxlength="50">
            </div>

            <div style="text-align: center;">
                <button class="btn btn-primary" onclick="startQuiz()" id="startBtn">
                    Start Assessment
                </button>
            </div>
        </div>

        <!-- Quiz Screen -->
        <div id="quizScreen" class="hidden">
            <!-- Header -->
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <div>
                        <h2 id="questionTitle">Question 1 of 20</h2>
                        <div class="question-info" id="questionInfo">Loading...</div>
                    </div>
                    <div class="timer" id="timer">35:00</div>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 5%;"></div>
                </div>
            </div>

            <!-- Question -->
            <div class="card">
                <div id="validationError" class="validation-error hidden">
                    ⚠️ Please select an answer before proceeding to the next question.
                </div>

                <div class="question" id="questionText">
                    Loading question...
                </div>

                <ul class="options" id="optionsList">
                    <!-- Options will be populated by JavaScript -->
                </ul>

                <div class="navigation">
                    <button class="btn btn-secondary" onclick="prevQuestion()" id="prevBtn" disabled>
                        Previous
                    </button>
                    
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-primary" onclick="nextQuestion()" id="nextBtn">
                            Next
                        </button>
                        <button class="btn btn-danger hidden" onclick="submitQuiz()" id="submitBtn">
                            Submit Assessment
                        </button>
                    </div>
                </div>

                <!-- Question Navigation Grid -->
                <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #ddd;">
                    <p style="margin-bottom: 15px; color: #666;">Question Status:</p>
                    <div class="question-grid" id="questionGrid">
                        <!-- Question numbers will be populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Completion Screen -->
        <div id="completionScreen" class="hidden">
            <div class="card completion-card">
                <div class="completion-icon" id="completionIcon">🎉</div>
                <h2>Assessment Completed!</h2>
                <p id="thankYouMessage">Thank you for completing the technical assessment!</p>

                <div class="score-display">
                    <div class="score-number" id="finalScore">20/20</div>
                    <div style="font-size: 1.5em; margin: 10px 0;" id="finalPercentage">100%</div>
                    <div class="grade-badge excellent" id="gradeBadge">Excellent</div>
                </div>

                <div id="submissionStatus" class="submission-status hidden">
                    <div class="loading-spinner" id="loadingSpinner"></div>
                    <p id="statusMessage">Submitting your results...</p>
                </div>

                <!-- Detailed Results Section -->
                <div id="detailedResultsContainer" class="detailed-results">
                    <h3 style="margin-bottom: 20px; text-align: center;">Detailed Results</h3>
                    <div id="detailedResultsList">
                        <!-- Will be populated by JavaScript -->
                    </div>
                </div>

                <p style="margin-top: 30px; color: #666; font-size: 14px;">
                    Your results have been saved to the database for analysis and reporting purposes.
                </p>

                <div style="margin-top: 30px;">
                    <button class="btn btn-primary" onclick="resetQuiz()" id="resetBtn">
                        Take Assessment Again
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Technical assessment questions
        const questions = [
            // Data Analysis Questions (8)
            {
                id: 1,
                category: 'Data Analysis',
                skill: 'Understanding Hidden Factors',
                question: 'You find that states with more POS agents have higher account opening rates. Lagos has 15,000 POS agents and 78% account penetration, while Yobe has 200 POS agents and 23% account penetration. Before recommending more POS agents for Yobe, what should you check first?',
                options: [
                    'How much POS agents earn in each state',
                    'Whether states with more POS agents also have better roads, electricity, and higher incomes',
                    'The total population of each state',
                    'How many banks operate in each state'
                ],
                correct: 'B',
                explanation: 'Richer states with better infrastructure naturally attract more POS agents AND have higher account penetration for many reasons. You must check if the relationship still holds when comparing similar states, or the policy might fail.'
            },
            {
                id: 2,
                category: 'Data Analysis',
                skill: 'Practical vs Statistical Importance',
                question: 'A BVN enrollment campaign increased enrollment from 45% to 48% in a survey of 50,000 people. The result is statistically significant. What is the most accurate interpretation?',
                options: [
                    'The effect is statistically significant, but the increase is small and may not be practically meaningful',
                    'Statistical significance means the campaign had a large effect',
                    'A large sample size can make even small effects statistically significant',
                    'Both A and C'
                ],
                correct: 'D',
                explanation: 'With 50,000 observations, even a 3% change can be statistically significant. Statistical significance does not always mean the effect is large or practically important. Both A (small effect size) and C (role of large sample) are correct.'
            },
            {
                id: 3,
                category: 'Data Analysis',
                skill: 'Recognizing Self-Selection Bias',
                question: 'Your data shows customers who use USSD banking have 40% fewer dormant account problems than those who don\'t. Before concluding that USSD prevents dormancy, what should you consider?',
                options: [
                    'The cost of USSD transactions',
                    'People who choose USSD are likely more tech-savvy and active bank users anyway',
                    'Which banks offer USSD services',
                    'How often people use USSD'
                ],
                correct: 'B',
                explanation: 'Self-selection bias: people who choose USSD banking are already more engaged with their accounts. Their lower dormancy might come from being active users, not from USSD itself. Need to compare similar users to isolate USSD\'s real effect.'
            },
            {
                id: 4,
                category: 'Data Analysis',
                skill: 'Understanding Data Reversals',
                question: 'Your loan approval data shows women get approved 60% of the time vs men at 65%. But when you look by loan type: microloans (women 75%, men 70%) and mortgage loans (women 45%, men 40%). Women do better in both categories but worse overall. What explains this?',
                options: [
                    'There are errors in the data',
                    'Women apply mostly for mortgages, men apply more for microloans, and mortgages are harder to get approved',
                    'Women apply mostly for microloans, men apply more for mortgages, and mortgages are harder to get approved',
                    'Banks discriminate against women only for mortgage loans'
                ],
                correct: 'B',
                explanation: 'This is an example of Simpson\'s Paradox. Women do better in each loan type, but because more of their applications are for mortgages (the harder loan to get), their overall approval rate looks lower. The overall average is misleading because it hides the difference in loan type distribution.'
            },
            {
                id: 5,
                category: 'Data Analysis',
                skill: 'Measurement Error Effects',
                question: 'You are studying the relationship between small business income and loan repayment rates. Business owners report their income in interviews, but many understate it to avoid taxes. How does this affect your analysis?',
                options: [
                    'It doesn\'t matter since everyone understates equally',
                    'It makes the connection between income and repayment appear weaker than it really is',
                    'It makes the connection appear stronger',
                    'It only affects the average income calculation'
                ],
                correct: 'B',
                explanation: 'When income is measured with error (understated), its relationship with repayment appears weaker than reality. If true income strongly predicts repayment but reported income is noisy, you might miss this important pattern for lending decisions.'
            },
            {
                id: 6,
                category: 'Data Analysis',
                skill: 'Understanding Base Rates',
                question: 'Your fraud detection system correctly identifies 90% of fraudulent transactions and has 8% false alarms. In Nigeria where only 0.2% of transactions are fraudulent, what percentage of transactions flagged as fraud are actually fraudulent?',
                options: [
                    '90% (the system\'s accuracy)',
                    'About 2% (most flagged transactions are actually legitimate)',
                    'About 82% (90% minus 8%)',
                    '99.8% (since fraud is very rare)'
                ],
                correct: 'B',
                explanation: 'With 0.2% fraud rate: out of 100,000 transactions, 200 are fraudulent (180 caught) and 99,800 are legitimate (7,984 false alarms). Total flagged: 8,164. Actual fraud: 180. So 180/8,164 = 2.2% of flagged transactions are truly fraudulent.'
            },
            {
                id: 7,
                category: 'Data Analysis',
                skill: 'Avoiding Survivor Bias',
                question: 'You want to evaluate agent banking performance by studying agents who have operated for 2+ years. You find 85% of these agents are profitable and conclude the agent banking model works well. What is the problem with this approach?',
                options: [
                    'Two years is too short a period',
                    'You\'re only looking at agents who survived - ignoring those who quit due to problems',
                    'Profitability is not a good measure',
                    'The sample size is too small'
                ],
                correct: 'B',
                explanation: 'Survivor bias: you\'re only studying agents who lasted 2+ years, automatically excluding those who failed and quit. This makes agent banking appear more successful than it is. Include all agents who started to get the true picture.'
            },
            {
                id: 8,
                category: 'Data Analysis',
                skill: 'Natural Performance Variation',
                question: 'After a customer service training program, you notice the worst-performing bank branches improved a lot, while the best-performing branches showed little change. Should CBN focus all future training on poor performers?',
                options: [
                    'Yes, poor performers clearly benefit more from training',
                    'Need to be careful - extreme performers naturally move toward average over time, regardless of training',
                    'No, good performers should get priority',
                    'The training only works for poor performers'
                ],
                correct: 'B',
                explanation: 'Regression to the mean: extremely poor or good performers tend to move toward average on re-measurement due to natural variation. Poor performers might improve anyway. Need a control group to separate training effects from natural changes.'
            },

          
              {
        id: 9,
        category: 'M&E',
        skill: 'Pre- and Post-Test Purpose',
        question: 'Why is it important to conduct a pre-test and a post-test in a program?',
        options: [
            'To measure changes in participants’ knowledge or skills',
            'To check whether participants understood the training content',
            'To evaluate how well the training materials were delivered',
            'To compare different groups of participants'
        ],
        correct: 'A',
        explanation: 'Pre- and post-tests allow you to measure changes in knowledge or skills attributable to the program. They help identify learning gains and areas needing improvement.'
    },
            
            ,
            {
                id: 10,
                category: 'M&E',
                skill: 'Output vs Outcome vs Impact',
                question: 'You evaluate a financial literacy program for rural farmers. After 6 months you find: 90% can calculate loan interest correctly, 70% now keep written business records, and farm profits increased 20%. How do you classify these results?',
                options: [
                    'All three show the program\'s impact',
                    'Knowledge is outcome, record-keeping is output, profits are impact',
                    'Knowledge is output, record-keeping is outcome, profits are impact',
                    'Only profit increase matters for evaluation'
                ],
                correct: 'C',
                explanation: 'In M&E logic: outputs are immediate results (knowledge gained), outcomes are behavior changes (keeping records), impacts are broader effects (increased profits). Each level requires different measurement approaches and timing.'
            },
            {
                id: 11,
                category: 'M&E',
                skill: 'Measuring Complex Outcomes',
                question: 'You need to measure whether consumer protection efforts have improved "financial security" for Nigerian families. Which set of indicators best captures this complex outcome?',
                options: [
                    'Only measure number of consumer complaints filed',
                    'Only measure household savings account balances',
                    'Combine: families\' ability to handle emergencies + reduced borrowing from loan sharks + maintained spending during income shocks',
                    'Survey families about whether they feel financially secure'
                ],
                correct: 'C',
                explanation: 'Complex outcomes like "financial security" need multiple indicators showing different aspects. Single measures miss the full picture. Good M&E combines behavioral evidence (emergency coping), financial evidence (borrowing patterns), and consumption evidence.'
            },
          {
        id: 12,
        category: 'M&E',
        skill: 'Monitoring vs Evaluation',
        question: 'What is the key difference between monitoring and evaluation?',
        options: [
            'Monitoring tracks activities and progress regularly; evaluation assesses overall outcomes and impact',
            'Monitoring measures participant satisfaction; evaluation measures knowledge gained',
            'Monitoring collects routine program data; evaluation examines whether objectives were achieved',
            'Monitoring focuses on short-term outputs; evaluation focuses on long-term results'
        ],
        correct: 'A',
        explanation: 'Monitoring is ongoing and tracks program implementation, while evaluation looks at whether the program achieved its intended outcomes and impact.'
    },
            {
                id: 13,
                category: 'M&E',
                skill: 'Logical Framework Design',
                question: 'Your logical framework for digital payment promotion has this impact: "Increased use of digital payments in Nigeria." The outcome is "Merchants accept digital payments." What is the most appropriate output indicator?',
                options: [
                    'Percentage of transactions done digitally nationwide',
                    'Number of merchants reporting increased sales from digital payments',
                    'Number of merchants trained in digital payment systems',
                    'Customer satisfaction with digital payment experiences'
                ],
                correct: 'C',
                explanation: 'Logical framework hierarchy: outputs are direct deliverables (merchants trained), outcomes are behavior changes (merchants accepting payments), impacts are system-level changes (increased digital payment use). Each builds logically on the previous level.'
            },

            // RCT/Impact Evaluation Questions (3)
            {
                id: 14,
                category: 'RCT/Impact',
                skill: 'Randomization Design Trade-offs',
                question: 'An organization wants to test a new agent banking training program across 200 agents in 40 local government areas (LGAs). You could randomize individual agents or entire LGAs. What is the key trade-off?',
                options: [
                    'Individual randomization gives better statistics but trained agents might share knowledge with untrained ones; LGA randomization prevents sharing but needs more LGAs for same statistical power',
                    'LGA randomization is always better',
                    'Individual randomization eliminates all bias',
                    'Both approaches give identical results'
                ],
                correct: 'A',
                explanation: 'Individual randomization maximizes statistical power but creates contamination risk (trained agents sharing with controls). LGA randomization prevents contamination but reduces effective sample size. Choice depends on spillover risk vs power needs.'
            },
            {
                id: 15,
                category: 'RCT/Impact',
                skill: 'Intent-to-Treat Analysis Logic',
                question: 'In a financial literacy RCT, 75% of people assigned to training actually attended, while 25% of the control group got similar training elsewhere. For policy decisions, which analysis approach is most useful?',
                options: [
                    'Compare only those who actually got training vs those who didn\'t',
                    'Compare based on original assignment regardless of actual participation',
                    'Exclude all people who didn\'t follow their assignment',
                    'Weight results by participation rates'
                ],
                correct: 'B',
                explanation: 'Intent-to-treat analysis preserves randomization and answers the policy question: "What happens when we offer this program?" Real implementation will have non-participation too. Comparing actual participants introduces bias since participation correlates with motivation.'
            },
            {
                id: 16,
                category: 'RCT/Impact',
                skill: 'Research vs Real-World Effects',
                question: 'A mobile banking education RCT showed 80% adoption with intensive support and monitoring. When scaled nationally with normal implementation, adoption dropped to 30%. This difference most likely reflects:',
                options: [
                    'The RCT was poorly designed',
                    'Research attention effects - intensive monitoring in RCT created artificial conditions not present in normal implementation',
                    'National rollout was badly managed',
                    'Mobile banking doesn\'t actually work'
                ],
                correct: 'B',
                explanation: 'Hawthorne effects occur when research attention changes behavior. RCTs with intensive monitoring, frequent check-ins, and researcher presence create ideal conditions. Good evaluation tests programs under realistic implementation conditions to predict real-world results.'
            },

            // Programming Logic Questions (4)
            {
                id: 17,
                category: 'Programming Logic',
                skill: 'Reliable System Design',
                question: 'An organization needs to process daily transaction reports from 24 banks to detect suspicious patterns. Some banks send files late or with errors. Which processing approach ensures reliable daily reports?',
                options: [
                    'Wait for all 24 banks before starting any processing',
                    'Process each bank\'s file separately with ability to retry failed banks without reprocessing successful ones',
                    'Process banks one by one - if any fails, restart everything',
                    'Process files as they arrive and manually handle missing banks'
                ],
                correct: 'B',
                explanation: 'Reliable systems use parallel processing with checkpoints. This allows retry of specific failures without losing successful work, ensuring timely reports even when some banks have problems. Critical for regulatory monitoring that can\'t wait for perfect data.'
            },
            {
                id: 18,
                category: 'Programming Logic',
                skill: 'System Performance Trade-offs',
                question: 'A real-time BVN verification system handles 50,000 requests/hour across multiple servers. Account balances must be accurate, but system must stay fast. You can either check all servers before each transaction or update balances with delays. What\'s the main trade-off?',
                options: [
                    'Checking all servers ensures accuracy but creates slowdowns; delayed updates maintain speed but risk temporary mismatches',
                    'Checking servers is always better for financial systems',
                    'Delayed updates are always faster and more reliable',
                    'Both approaches give identical results'
                ],
                correct: 'A',
                explanation: 'Classic system trade-off: accuracy vs speed. Real-time checks ensure data consistency but create bottlenecks. Delayed updates maintain performance but require handling temporary inconsistencies. Financial systems must carefully balance these needs.'
            },
            {
                id: 19,
                category: 'Programming Logic',
                skill: 'Data Integrity Protection',
                question: 'A nightly job processes customer complaints to update bank ratings. The job fails halfway through, leaving some banks\' ratings updated and others not. What principle prevents this data corruption?',
                options: [
                    'Process banks in random order for speed',
                    'Use database transactions - either all bank ratings update or none do',
                    'Process each bank separately and fix errors manually later',
                    'Run the job multiple times until completion'
                ],
                correct: 'B',
                explanation: 'Database transactions ensure atomicity - operations either completely succeed or completely fail. For regulatory data integrity, partial updates are dangerous. All-or-nothing processing prevents inconsistent states where some ratings reflect new complaints while others don\'t.'
            },
            {
                id: 20,
                category: 'Programming Logic',
                skill: 'Optimization Strategy',
                question: 'An agent verification system searches 5 million agent records by phone number, taking 45 seconds per search. You could: add more servers, create a phone number index, cache frequent searches, or upgrade hardware. What gives the biggest improvement?',
                options: [
                    'More servers to distribute workload',
                    'Phone number index to enable fast lookups',
                    'Caching to avoid repeated database queries',
                    'Hardware upgrade for faster processing'
                ],
                correct: 'B',
                explanation: 'Algorithmic improvements beat hardware improvements. Searching 5M records linearly takes much longer than indexed search. An index provides 1000x+ improvement (from 45 seconds to milliseconds), while hardware might give 2-10x. Smart design beats expensive equipment.'
            }
        ];

        let currentQuestionIndex = 0;
        let answers = {};
        let participantName = '';
        let timeLeft = 2100; // 35 minutes in seconds
        let timerInterval;
        let quizStartTime;

        // Initialize the quiz
        function startQuiz() {
            const nameInput = document.getElementById('participantName');
            participantName = nameInput.value.trim();
            
            if (!participantName) {
                alert('Please enter your name before starting the assessment.');
                return;
            }

            if (participantName.length < 2) {
                alert('Please enter your full name (at least 2 characters).');
                return;
            }

            // Record start time
            quizStartTime = new Date();

            // Hide start screen, show quiz screen
            document.getElementById('startScreen').classList.add('hidden');
            document.getElementById('quizScreen').classList.remove('hidden');

            // Initialize quiz
            answers = {};
            currentQuestionIndex = 0;
            
            // Start timer
            startTimer();
            
            // Load first question
            loadQuestion();
            
            // Create question navigation grid
            createQuestionGrid();
        }

        function startTimer() {
            timerInterval = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    submitQuiz();
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            const timerElement = document.getElementById('timer');
            timerElement.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            
            // Change color when time is running out
            if (timeLeft <= 300) { // 5 minutes
                timerElement.style.background = '#ff4444';
            } else if (timeLeft <= 600) { // 10 minutes
                timerElement.style.background = '#ff8800';
            }
        }

        function loadQuestion() {
            const question = questions[currentQuestionIndex];
            
            // Update question title and info
            document.getElementById('questionTitle').textContent = `Question ${currentQuestionIndex + 1} of ${questions.length}`;
            document.getElementById('questionInfo').textContent = `${question.category}`;
            
            // Update question text
            document.getElementById('questionText').textContent = question.question;
            
            // Update progress bar
            const progress = ((currentQuestionIndex + 1) / questions.length) * 100;
            document.getElementById('progressFill').style.width = `${progress}%`;
            
            // Create options
            const optionsList = document.getElementById('optionsList');
            optionsList.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const optionLetter = String.fromCharCode(65 + index); // A, B, C, D
                const li = document.createElement('li');
                li.className = 'option';
                
                const isSelected = answers[question.id] === optionLetter;
                if (isSelected) {
                    li.classList.add('selected');
                }
                
                li.innerHTML = `
                    <input type="radio" name="question${question.id}" value="${optionLetter}" ${isSelected ? 'checked' : ''}>
                    <span style="font-weight: bold; margin-right: 10px;">${optionLetter}.</span>
                    ${option}
                `;
                
                li.addEventListener('click', () => selectOption(question.id, optionLetter));
                optionsList.appendChild(li);
            });
            
            // Update navigation buttons
            updateNavigationButtons();
            updateQuestionGrid();
            
            // Hide validation error
            document.getElementById('validationError').classList.add('hidden');
        }

        function selectOption(questionId, optionLetter) {
            answers[questionId] = optionLetter;
            
            // Update visual selection
            const optionsList = document.getElementById('optionsList');
            const options = optionsList.querySelectorAll('.option');
            options.forEach(option => option.classList.remove('selected'));
            
            const selectedOption = [...options].find(opt => 
                opt.querySelector('input').value === optionLetter
            );
            if (selectedOption) {
                selectedOption.classList.add('selected');
                selectedOption.querySelector('input').checked = true;
            }
            
            updateQuestionGrid();
            
            // Hide validation error if it was showing
            document.getElementById('validationError').classList.add('hidden');
        }

        function nextQuestion() {
            const currentQuestion = questions[currentQuestionIndex];
            
            // Check if current question is answered (mandatory)
            if (!answers[currentQuestion.id]) {
                document.getElementById('validationError').classList.remove('hidden');
                return;
            }
            
            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                loadQuestion();
            }
        }

        function prevQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                loadQuestion();
            }
        }

        function goToQuestion(index) {
            currentQuestionIndex = index;
            loadQuestion();
        }

        function updateNavigationButtons() {
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const submitBtn = document.getElementById('submitBtn');
            
            prevBtn.disabled = currentQuestionIndex === 0;
            
            if (currentQuestionIndex === questions.length - 1) {
                nextBtn.classList.add('hidden');
                submitBtn.classList.remove('hidden');
            } else {
                nextBtn.classList.remove('hidden');
                submitBtn.classList.add('hidden');
            }
        }

        function createQuestionGrid() {
            const grid = document.getElementById('questionGrid');
            grid.innerHTML = '';
            
            for (let i = 0; i < questions.length; i++) {
                const questionNum = document.createElement('div');
                questionNum.className = 'question-number';
                questionNum.textContent = i + 1;
                questionNum.onclick = () => goToQuestion(i);
                grid.appendChild(questionNum);
            }
            
            updateQuestionGrid();
        }

        function updateQuestionGrid() {
            const questionNumbers = document.querySelectorAll('.question-number');
            questionNumbers.forEach((num, index) => {
                num.className = 'question-number';
                
                if (index === currentQuestionIndex) {
                    num.classList.add('current');
                } else if (answers[questions[index].id]) {
                    num.classList.add('answered');
                }
            });
        }

        function createDetailedResults(score, total) {
            const container = document.getElementById('detailedResultsList');
            container.innerHTML = '';

            let correctCount = 0;
            let incorrectCount = 0;

            questions.forEach(question => {
                const userAnswer = answers[question.id];
                const isCorrect = userAnswer === question.correct;
                
                if (isCorrect) {
                    correctCount++;
                } else {
                    incorrectCount++;
                }

                const resultDiv = document.createElement('div');
                resultDiv.className = `result-question ${isCorrect ? 'correct' : 'incorrect'}`;
                
                const optionTexts = {};
                question.options.forEach((option, index) => {
                    optionTexts[String.fromCharCode(65 + index)] = option;
                });

                resultDiv.innerHTML = `
                    <h4>Question ${question.id}: ${question.category}</h4>
                    <p style="margin-bottom: 10px;">${question.question}</p>
                    <div class="result-details">
                        ${!isCorrect ? `<p><span class="your-answer">Your answer: ${userAnswer}.</span> ${optionTexts[userAnswer]}</p>` : ''}
                        <p><span class="correct-answer">Correct answer: ${question.correct}.</span> ${optionTexts[question.correct]}</p>
                        <div class="explanation">
                            <strong>Explanation:</strong> ${question.explanation}
                        </div>
                    </div>
                `;
                
                container.appendChild(resultDiv);
            });

            // Add summary at the top
            const summaryDiv = document.createElement('div');
            summaryDiv.style.cssText = 'margin-bottom: 20px; padding: 15px; background: #e3f2fd; border-radius: 6px; text-align: center;';
            summaryDiv.innerHTML = `
                <h4 style="color: #1976d2; margin-bottom: 10px;">Results Summary</h4>
                <p><strong>Correct:</strong> ${correctCount} questions | <strong>Incorrect:</strong> ${incorrectCount} questions</p>
                <p style="margin-top: 8px; font-size: 14px; color: #666;">
                    ${incorrectCount > 0 ? 'Review the incorrect answers below to learn more.' : 'Perfect score! Excellent work.'}
                </p>
            `;
            container.insertBefore(summaryDiv, container.firstChild);
        }

        async function submitQuiz() {
            // Check if all questions are answered
            const unansweredQuestions = [];
            questions.forEach(q => {
                if (!answers[q.id]) {
                    unansweredQuestions.push(q.id);
                }
            });
            
            if (unansweredQuestions.length > 0) {
                alert(`Please answer all questions before submitting. Missing: Question(s) ${unansweredQuestions.join(', ')}`);
                return;
            }
            
            // Calculate score and time taken
            let score = 0;
            questions.forEach(q => {
                if (answers[q.id] === q.correct) {
                    score++;
                }
            });

            const quizEndTime = new Date();
            const timeTakenSeconds = Math.floor((quizEndTime - quizStartTime) / 1000);
            
            // Stop timer
            clearInterval(timerInterval);
            
            // Show completion screen first
            showCompletionScreen(score, questions.length);
            
            // Create detailed results
            createDetailedResults(score, questions.length);
            
            // Prepare data for submission
            const quizResult = {
                participant_name: participantName,
                completed_at: quizEndTime.toISOString(),
                total_score: score,
                percentage: Math.round((score / questions.length) * 100),
                time_taken: timeTakenSeconds
            };
            
            // Add individual question responses
            questions.forEach(q => {
                quizResult[`Q${q.id}`] = answers[q.id] || '';
                quizResult[`Q${q.id}_correct`] = q.correct;
                quizResult[`Q${q.id}_skill`] = q.skill;
                quizResult[`Q${q.id}_category`] = q.category;
            });
            
            // Submit to backend
            await submitToDatabase(quizResult);
        }

        async function submitToDatabase(data) {
            const statusDiv = document.getElementById('submissionStatus');
            const statusMessage = document.getElementById('statusMessage');
            const loadingSpinner = document.getElementById('loadingSpinner');
            
            // Show submission status
            statusDiv.classList.remove('hidden');
            statusMessage.textContent = 'Submitting your results...';
            loadingSpinner.style.display = 'block';
            
            console.log('Attempting to submit assessment data:', data);
            
            try {
                const response = await fetch('/api/submit-quiz', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });
                
                console.log('Response received:', response.status, response.statusText);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('HTTP Error:', response.status, errorText);
                    throw new Error(`HTTP ${response.status}: ${errorText}`);
                }
                
                const result = await response.json();
                console.log('Success response:', result);
                
                if (result.success) {
                    // Success
                    loadingSpinner.style.display = 'none';
                    statusMessage.textContent = `Results successfully saved! (ID: ${result.id})`;
                    statusDiv.style.background = '#e8f5e8';
                    statusDiv.style.color = '#2e7d2e';
                    statusDiv.style.borderLeftColor = '#11853d';
                    
                    console.log('Assessment submitted successfully:', result);
                } else {
                    throw new Error(result.error || 'Submission failed');
                }
            } catch (error) {
                console.error('Error submitting assessment:', error);
                
                // Show error but don't prevent completion
                loadingSpinner.style.display = 'none';
                statusMessage.textContent = `Warning: Results may not have been saved. Error: ${error.message}. Please inform the administrator.`;
                statusDiv.style.background = '#fff3e0';
                statusDiv.style.color = '#e65100';
                statusDiv.style.borderLeftColor = '#ff9800';
            }
        }

        function showCompletionScreen(score, total) {
            const percentage = Math.round((score / total) * 100);
            
            // Hide quiz screen, show completion screen
            document.getElementById('quizScreen').classList.add('hidden');
            document.getElementById('completionScreen').classList.remove('hidden');
            
            // Update completion screen
            document.getElementById('finalScore').textContent = `${score}/${total}`;
            document.getElementById('finalPercentage').textContent = `${percentage}%`;
            document.getElementById('thankYouMessage').textContent = `Thank you, ${participantName}!`;
            
            // Set icon and grade
            const icon = document.getElementById('completionIcon');
            const badge = document.getElementById('gradeBadge');
            
            if (percentage >= 80) {
                icon.textContent = '🎉';
                badge.textContent = 'Excellent';
                badge.className = 'grade-badge excellent';
            } else if (percentage >= 60) {
                icon.textContent = '👍';
                badge.textContent = 'Good';
                badge.className = 'grade-badge good';
            } else {
                icon.textContent = '📚';
                badge.textContent = 'Needs Improvement';
                badge.className = 'grade-badge needs-improvement';
            }
        }

        function resetQuiz() {
            // Reset all variables
            currentQuestionIndex = 0;
            answers = {};
            participantName = '';
            timeLeft = 2100;
            quizStartTime = null;
            
            // Clear timer
            clearInterval(timerInterval);
            
            // Reset form
            document.getElementById('participantName').value = '';
            
            // Hide status message
            document.getElementById('submissionStatus').classList.add('hidden');
            
            // Show start screen
            document.getElementById('completionScreen').classList.add('hidden');
            document.getElementById('startScreen').classList.remove('hidden');
        }

        // Initialize when page loads
        window.addEventListener('load', () => {
            console.log('IPA Technical Assessment loaded successfully');
            console.log('Questions available:', questions.length);
            console.log('Focus areas: Data Analysis, M&E, RCT/Impact, Programming Logic');
        });

        // Prevent accidental page refresh during quiz
        window.addEventListener('beforeunload', function (e) {
            if (document.getElementById('quizScreen').classList.contains('hidden')) {
                return; // Quiz not in progress
            }
            
            const confirmationMessage = 'Are you sure you want to leave? Your assessment progress will be lost.';
            e.returnValue = confirmationMessage;
            return confirmationMessage;
        });

        // Handle page visibility change (tab switching, etc.)
        document.addEventListener('visibilitychange', function() {
            if (document.hidden && !document.getElementById('quizScreen').classList.contains('hidden')) {
                console.log('User switched tabs during assessment at:', new Date().toISOString());
                // You could implement additional security measures here
            }
        });
    </script>
</body>
</html>