<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Technical Assessment Quiz</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f5f5f5;
            line-height: 1.6;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        .card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 30px;
            margin-bottom: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            color: #333;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .timer {
            background: #ff4444;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            font-size: 1.2em;
            font-weight: bold;
            float: right;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: #e0e0e0;
            border-radius: 5px;
            margin: 20px 0;
        }

        .progress-fill {
            height: 100%;
            background: #4CAF50;
            border-radius: 5px;
            transition: width 0.3s ease;
        }

        .question-info {
            color: #666;
            margin-bottom: 20px;
        }

        .question {
            font-size: 1.2em;
            margin-bottom: 25px;
            line-height: 1.6;
            white-space: pre-line;
        }

        .options {
            list-style: none;
            margin-bottom: 30px;
        }

        .option {
            margin-bottom: 15px;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }

        .option:hover {
            border-color: #4CAF50;
            background: #f8f8f8;
        }

        .option.selected {
            border-color: #4CAF50;
            background: #e8f5e8;
        }

        .option input[type="radio"] {
            margin-right: 10px;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 30px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary {
            background: #4CAF50;
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background: #45a049;
        }

        .btn-secondary {
            background: #666;
            color: white;
        }

        .btn-secondary:hover:not(:disabled) {
            background: #555;
        }

        .btn-danger {
            background: #ff4444;
            color: white;
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .question-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 20px;
        }

        .question-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-weight: bold;
            border: 2px solid #ddd;
            background: white;
            transition: all 0.3s ease;
        }

        .question-number.answered {
            background: #4CAF50;
            color: white;
            border-color: #4CAF50;
        }

        .question-number.current {
            background: #2196F3;
            color: white;
            border-color: #2196F3;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
        }

        .quiz-info {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 25px;
        }

        .quiz-info h3 {
            color: #1976d2;
            margin-bottom: 15px;
        }

        .quiz-info ul {
            margin-left: 20px;
        }

        .quiz-info li {
            margin-bottom: 8px;
            color: #1976d2;
        }

        .completion-card {
            text-align: center;
            padding: 40px;
        }

        .completion-icon {
            font-size: 4em;
            margin-bottom: 20px;
        }

        .score-display {
            background: #f5f5f5;
            padding: 30px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .score-number {
            font-size: 3em;
            font-weight: bold;
            color: #4CAF50;
        }

        .grade-badge {
            padding: 10px 20px;
            border-radius: 25px;
            color: white;
            font-weight: bold;
            margin-top: 10px;
            display: inline-block;
        }

        .excellent { background: #4CAF50; }
        .good { background: #FF9800; }
        .needs-improvement { background: #f44336; }

        .validation-error {
            background: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            border-left: 4px solid #f44336;
        }

        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .submission-status {
            background: #e8f5e8;
            color: #2e7d2e;
            padding: 15px;
            border-radius: 6px;
            margin-top: 20px;
            border-left: 4px solid #4CAF50;
        }

        .hidden {
            display: none;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .card {
                padding: 20px;
            }
            
            .timer {
                float: none;
                display: block;
                text-align: center;
                margin-bottom: 20px;
            }
            
            .question-grid {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Start Screen -->
        <div id="startScreen" class="card">
            <div class="header">
                <h1>üìä Technical Assessment Quiz</h1>
            </div>

            <div class="quiz-info">
                <h3>Quiz Information:</h3>
                <ul>
                    <li>15 Multiple Choice Questions</li>
                    <li>30 Minutes Time Limit</li>
                    <li>70% Data Analysis, 30% Programming Logic</li>
                    <li>All questions are mandatory</li>
                    <li>Results are automatically saved to the database</li>
                    <li>You can navigate between questions before submitting</li>
                </ul>
            </div>

            <div class="form-group">
                <label for="participantName">Your Full Name:</label>
                <input type="text" id="participantName" placeholder="Enter your full name" maxlength="50">
            </div>

            <div style="text-align: center;">
                <button class="btn btn-primary" onclick="startQuiz()" id="startBtn">
                    Start Quiz
                </button>
            </div>
        </div>

        <!-- Quiz Screen -->
        <div id="quizScreen" class="hidden">
            <!-- Header -->
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <div>
                        <h2 id="questionTitle">Question 1 of 15</h2>
                        <div class="question-info" id="questionInfo">Data Analysis - Excel</div>
                    </div>
                    <div class="timer" id="timer">30:00</div>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 6.67%;"></div>
                </div>
            </div>

            <!-- Question -->
            <div class="card">
                <div id="validationError" class="validation-error hidden">
                    ‚ö†Ô∏è Please select an answer before proceeding to the next question.
                </div>

                <div class="question" id="questionText">
                    Loading question...
                </div>

                <ul class="options" id="optionsList">
                    <!-- Options will be populated by JavaScript -->
                </ul>

                <div class="navigation">
                    <button class="btn btn-secondary" onclick="prevQuestion()" id="prevBtn" disabled>
                        Previous
                    </button>
                    
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-primary" onclick="nextQuestion()" id="nextBtn">
                            Next
                        </button>
                        <button class="btn btn-danger hidden" onclick="submitQuiz()" id="submitBtn">
                            Submit Quiz
                        </button>
                    </div>
                </div>

                <!-- Question Navigation Grid -->
                <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #ddd;">
                    <p style="margin-bottom: 15px; color: #666;">Question Status:</p>
                    <div class="question-grid" id="questionGrid">
                        <!-- Question numbers will be populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Completion Screen -->
        <div id="completionScreen" class="hidden">
            <div class="card completion-card">
                <div class="completion-icon" id="completionIcon">üéâ</div>
                <h2>Quiz Completed!</h2>
                <p id="thankYouMessage">Thank you for completing the assessment!</p>

                <div class="score-display">
                    <div class="score-number" id="finalScore">15/15</div>
                    <div style="font-size: 1.5em; margin: 10px 0;" id="finalPercentage">100%</div>
                    <div class="grade-badge excellent" id="gradeBadge">Excellent</div>
                </div>

                <div id="submissionStatus" class="submission-status hidden">
                    <div class="loading-spinner" id="loadingSpinner"></div>
                    <p id="statusMessage">Submitting your results...</p>
                </div>

                <p style="margin-top: 30px; color: #666; font-size: 14px;">
                    Your results have been securely saved to the database. The administrator can now access your assessment data for analysis and reporting.
                </p>

                <div style="margin-top: 30px;">
                    <button class="btn btn-primary" onclick="resetQuiz()" id="resetBtn">
                        Take Quiz Again
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Questions data embedded directly (no external file needed)
        const questions = [
            {
                id: 1,
                category: 'Data Analysis',
                skill: 'Excel - Pivot Tables',
                question: 'You have a sales dataset with columns: Region, Product, Sales. Which Excel feature allows you to quickly summarize total sales per region?',
                options: ['VLOOKUP', 'Pivot Table', 'Conditional Formatting', 'Data Validation'],
                correct: 'B'
            },
            {
                id: 2,
                category: 'Data Analysis',
                skill: 'Excel - Data Cleaning',
                question: 'Which function is most useful for removing extra spaces in Excel cells?',
                options: ['CLEAN', 'SUBSTITUTE', 'TRIM', 'CONCATENATE'],
                correct: 'C'
            },
            {
                id: 3,
                category: 'Data Analysis',
                skill: 'Power BI - Visualization',
                question: 'To show the contribution of each product category to total sales, which visualization is most appropriate?',
                options: ['Line chart', 'Pie/Donut chart', 'Scatter plot', 'Histogram'],
                correct: 'B'
            },
            {
                id: 4,
                category: 'Data Analysis',
                skill: 'Excel - Lookup Functions',
                question: 'Which formula would you use to find the price of a product based on its ID from another sheet?',
                options: ['INDEX-MATCH', 'CONCAT', 'IF', 'LEN'],
                correct: 'A'
            },
            {
                id: 5,
                category: 'Data Analysis',
                skill: 'Data Cleaning Concepts',
                question: 'Your dataset has missing values in the Age column. What is NOT a valid method of handling missing data?',
                options: ['Imputing with mean/median', 'Removing rows with missing values', 'Replacing with random noise', 'Leaving them as missing if analysis method supports it'],
                correct: 'C'
            },
            {
                id: 6,
                category: 'Data Analysis',
                skill: 'Statistical Understanding',
                question: 'Which measure of central tendency is LEAST affected by extreme outliers?',
                options: ['Mean', 'Median', 'Mode', 'Standard Deviation'],
                correct: 'B'
            },
            {
                id: 7,
                category: 'Data Analysis',
                skill: 'Data Interpretation',
                question: 'A correlation of -0.85 between hours worked and errors made suggests:',
                options: ['No relationship', 'Strong negative relationship', 'Strong positive relationship', 'Weak positive relationship'],
                correct: 'B'
            },
            {
                id: 8,
                category: 'Data Analysis',
                skill: 'Excel - Formulas',
                question: 'Which Excel function would you use to count cells that meet a specific criteria?',
                options: ['SUM', 'AVERAGE', 'COUNTIF', 'MAX'],
                correct: 'C'
            },
            {
                id: 9,
                category: 'Data Analysis',
                skill: 'Data Types',
                question: 'In a dataset, which data type is most appropriate for storing categorical information like "High", "Medium", "Low"?',
                options: ['Numeric', 'Date/Time', 'Text/String', 'Boolean'],
                correct: 'C'
            },
            {
                id: 10,
                category: 'Data Analysis',
                skill: 'Power BI - DAX',
                question: 'In Power BI, what does DAX stand for?',
                options: ['Data Analysis Extensions', 'Data Analysis Expressions', 'Database Analysis Exchange', 'Dynamic Analytics Exchange'],
                correct: 'B'
            },
            {
                id: 11,
                category: 'Programming Logic',
                skill: 'Conditional Statements',
                question: 'What does this pseudocode do?\n\nIF Age >= 18 THEN\n   PRINT "Adult"\nELSE\n   PRINT "Minor"',
                options: ['Always prints "Adult"', 'Categorizes based on age', 'Always prints "Minor"', 'Prints both'],
                correct: 'B'
            },
            {
                id: 12,
                category: 'Programming Logic',
                skill: 'Iteration Logic',
                question: 'Which loop is best suited when the number of iterations is known beforehand?',
                options: ['WHILE loop', 'FOR loop', 'REPEAT loop', 'IF statement'],
                correct: 'B'
            },
            {
                id: 13,
                category: 'Programming Logic',
                skill: 'Data Handling Concepts',
                question: 'In most programming languages, missing values are often represented as:',
                options: ['0', '"missing"', 'NULL or NA', '-1'],
                correct: 'C'
            },
            {
                id: 14,
                category: 'Programming Logic',
                skill: 'Boolean Logic',
                question: 'What is the result of: (True AND False) OR True?',
                options: ['True', 'False', 'Error', 'Cannot be determined'],
                correct: 'A'
            },
            {
                id: 15,
                category: 'Programming Logic',
                skill: 'Algorithm Logic',
                question: 'To find the maximum value in a list of numbers, which approach is most efficient?',
                options: ['Sort the list first, then take the last element', 'Compare each element with current maximum', 'Calculate average and find values above it', 'Use a nested loop to compare all pairs'],
                correct: 'B'
            }
        ];

        let currentQuestionIndex = 0;
        let answers = {};
        let participantName = '';
        let timeLeft = 1800; // 30 minutes in seconds
        let timerInterval;
        let quizStartTime;

        // No need to load questions - they're embedded above
        function loadQuestions() {
            // Questions are already available, just log success
            console.log('Questions loaded successfully:', questions.length, 'questions');
        }

        // Initialize the quiz
        function startQuiz() {
            const nameInput = document.getElementById('participantName');
            participantName = nameInput.value.trim();
            
            if (!participantName) {
                alert('Please enter your name before starting the quiz.');
                return;
            }

            if (participantName.length < 2) {
                alert('Please enter your full name (at least 2 characters).');
                return;
            }

            // Record start time
            quizStartTime = new Date();

            // Hide start screen, show quiz screen
            document.getElementById('startScreen').classList.add('hidden');
            document.getElementById('quizScreen').classList.remove('hidden');

            // Initialize quiz
            answers = {};
            currentQuestionIndex = 0;
            
            // Start timer
            startTimer();
            
            // Load first question
            loadQuestion();
            
            // Create question navigation grid
            createQuestionGrid();
        }

        function startTimer() {
            timerInterval = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    submitQuiz();
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            const timerElement = document.getElementById('timer');
            timerElement.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            
            // Change color when time is running out
            if (timeLeft <= 300) { // 5 minutes
                timerElement.style.background = '#ff4444';
            } else if (timeLeft <= 600) { // 10 minutes
                timerElement.style.background = '#ff8800';
            }
        }

        function loadQuestion() {
            const question = questions[currentQuestionIndex];
            
            // Update question title and info
            document.getElementById('questionTitle').textContent = `Question ${currentQuestionIndex + 1} of ${questions.length}`;
            document.getElementById('questionInfo').textContent = `${question.category} - ${question.skill}`;
            
            // Update question text
            document.getElementById('questionText').textContent = question.question;
            
            // Update progress bar
            const progress = ((currentQuestionIndex + 1) / questions.length) * 100;
            document.getElementById('progressFill').style.width = `${progress}%`;
            
            // Create options
            const optionsList = document.getElementById('optionsList');
            optionsList.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const optionLetter = String.fromCharCode(65 + index); // A, B, C, D
                const li = document.createElement('li');
                li.className = 'option';
                
                const isSelected = answers[question.id] === optionLetter;
                if (isSelected) {
                    li.classList.add('selected');
                }
                
                li.innerHTML = `
                    <input type="radio" name="question${question.id}" value="${optionLetter}" ${isSelected ? 'checked' : ''}>
                    <span style="font-weight: bold; margin-right: 10px;">${optionLetter}.</span>
                    ${option}
                `;
                
                li.addEventListener('click', () => selectOption(question.id, optionLetter));
                optionsList.appendChild(li);
            });
            
            // Update navigation buttons
            updateNavigationButtons();
            updateQuestionGrid();
            
            // Hide validation error
            document.getElementById('validationError').classList.add('hidden');
        }

        function selectOption(questionId, optionLetter) {
            answers[questionId] = optionLetter;
            
            // Update visual selection
            const optionsList = document.getElementById('optionsList');
            const options = optionsList.querySelectorAll('.option');
            options.forEach(option => option.classList.remove('selected'));
            
            const selectedOption = [...options].find(opt => 
                opt.querySelector('input').value === optionLetter
            );
            if (selectedOption) {
                selectedOption.classList.add('selected');
                selectedOption.querySelector('input').checked = true;
            }
            
            updateQuestionGrid();
            
            // Hide validation error if it was showing
            document.getElementById('validationError').classList.add('hidden');
        }

        function nextQuestion() {
            const currentQuestion = questions[currentQuestionIndex];
            
            // Check if current question is answered (mandatory)
            if (!answers[currentQuestion.id]) {
                document.getElementById('validationError').classList.remove('hidden');
                return;
            }
            
            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                loadQuestion();
            }
        }

        function prevQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                loadQuestion();
            }
        }

        function goToQuestion(index) {
            currentQuestionIndex = index;
            loadQuestion();
        }

        function updateNavigationButtons() {
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const submitBtn = document.getElementById('submitBtn');
            
            prevBtn.disabled = currentQuestionIndex === 0;
            
            if (currentQuestionIndex === questions.length - 1) {
                nextBtn.classList.add('hidden');
                submitBtn.classList.remove('hidden');
            } else {
                nextBtn.classList.remove('hidden');
                submitBtn.classList.add('hidden');
            }
        }

        function createQuestionGrid() {
            const grid = document.getElementById('questionGrid');
            grid.innerHTML = '';
            
            for (let i = 0; i < questions.length; i++) {
                const questionNum = document.createElement('div');
                questionNum.className = 'question-number';
                questionNum.textContent = i + 1;
                questionNum.onclick = () => goToQuestion(i);
                grid.appendChild(questionNum);
            }
            
            updateQuestionGrid();
        }

        function updateQuestionGrid() {
            const questionNumbers = document.querySelectorAll('.question-number');
            questionNumbers.forEach((num, index) => {
                num.className = 'question-number';
                
                if (index === currentQuestionIndex) {
                    num.classList.add('current');
                } else if (answers[questions[index].id]) {
                    num.classList.add('answered');
                }
            });
        }

        async function submitQuiz() {
            // Check if all questions are answered
            const unansweredQuestions = [];
            questions.forEach(q => {
                if (!answers[q.id]) {
                    unansweredQuestions.push(q.id);
                }
            });
            
            if (unansweredQuestions.length > 0) {
                alert(`Please answer all questions before submitting. Missing: Question(s) ${unansweredQuestions.join(', ')}`);
                return;
            }
            
            // Calculate score and time taken
            let score = 0;
            questions.forEach(q => {
                if (answers[q.id] === q.correct) {
                    score++;
                }
            });

            const quizEndTime = new Date();
            const timeTakenSeconds = Math.floor((quizEndTime - quizStartTime) / 1000);
            
            // Stop timer
            clearInterval(timerInterval);
            
            // Show completion screen first
            showCompletionScreen(score, questions.length);
            
            // Prepare data for submission
            const quizResult = {
                participant_name: participantName,
                completed_at: quizEndTime.toISOString(),
                total_score: score,
                percentage: Math.round((score / questions.length) * 100),
                time_taken: timeTakenSeconds
            };
            
            // Add individual question responses
            questions.forEach(q => {
                quizResult[`Q${q.id}`] = answers[q.id] || '';
                quizResult[`Q${q.id}_correct`] = q.correct;
                quizResult[`Q${q.id}_skill`] = q.skill;
                quizResult[`Q${q.id}_category`] = q.category;
            });
            
            // Submit to backend
            await submitToDatabase(quizResult);
        }

        async function submitToDatabase(data) {
            const statusDiv = document.getElementById('submissionStatus');
            const statusMessage = document.getElementById('statusMessage');
            const loadingSpinner = document.getElementById('loadingSpinner');
            
            // Show submission status
            statusDiv.classList.remove('hidden');
            statusMessage.textContent = 'Submitting your results to the database...';
            loadingSpinner.style.display = 'block';
            
            try {
                const response = await fetch('/api/submit-quiz', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                
                if (response.ok && result.success) {
                    // Success
                    loadingSpinner.style.display = 'none';
                    statusMessage.textContent = '‚úÖ Results successfully saved to database!';
                    statusDiv.style.background = '#e8f5e8';
                    statusDiv.style.color = '#2e7d2e';
                    statusDiv.style.borderLeftColor = '#4CAF50';
                    
                    console.log('Quiz submitted successfully:', result);
                } else {
                    throw new Error(result.error || 'Submission failed');
                }
            } catch (error) {
                console.error('Error submitting quiz:', error);
                
                // Show error but don't prevent completion
                loadingSpinner.style.display = 'none';
                statusMessage.textContent = '‚ö†Ô∏è Warning: Results may not have been saved. Please inform the administrator.';
                statusDiv.style.background = '#fff3e0';
                statusDiv.style.color = '#e65100';
                statusDiv.style.borderLeftColor = '#ff9800';
                
                // Also try to save locally as backup
                try {
                    const existingData = JSON.parse(localStorage.getItem('quizResultsBackup') || '[]');
                    existingData.push(data);
                    localStorage.setItem('quizResultsBackup', JSON.stringify(existingData));
                    statusMessage.textContent += ' (Saved locally as backup)';
                } catch (localError) {
                    console.error('Failed to save local backup:', localError);
                }
            }
        }

        function showCompletionScreen(score, total) {
            const percentage = Math.round((score / total) * 100);
            
            // Hide quiz screen, show completion screen
            document.getElementById('quizScreen').classList.add('hidden');
            document.getElementById('completionScreen').classList.remove('hidden');
            
            // Update completion screen
            document.getElementById('finalScore').textContent = `${score}/${total}`;
            document.getElementById('finalPercentage').textContent = `${percentage}%`;
            document.getElementById('thankYouMessage').textContent = `Thank you, ${participantName}!`;
            
            // Set icon and grade
            const icon = document.getElementById('completionIcon');
            const badge = document.getElementById('gradeBadge');
            
            if (percentage >= 80) {
                icon.textContent = 'üéâ';
                badge.textContent = 'Excellent';
                badge.className = 'grade-badge excellent';
            } else if (percentage >= 60) {
                icon.textContent = 'üëç';
                badge.textContent = 'Good';
                badge.className = 'grade-badge good';
            } else {
                icon.textContent = 'üìö';
                badge.textContent = 'Needs Improvement';
                badge.className = 'grade-badge needs-improvement';
            }
        }

        function resetQuiz() {
            // Reset all variables
            currentQuestionIndex = 0;
            answers = {};
            participantName = '';
            timeLeft = 1800;
            quizStartTime = null;
            
            // Clear timer
            clearInterval(timerInterval);
            
            // Reset form
            document.getElementById('participantName').value = '';
            
            // Hide status message
            document.getElementById('submissionStatus').classList.add('hidden');
            
            // Show start screen
            document.getElementById('completionScreen').classList.add('hidden');
            document.getElementById('startScreen').classList.remove('hidden');
        }

        // Initialize when page loads
        window.addEventListener('load', loadQuestions);

        // Prevent accidental page refresh during quiz
        window.addEventListener('beforeunload', function (e) {
            if (document.getElementById('quizScreen').classList.contains('hidden')) {
                return; // Quiz not in progress
            }
            
            const confirmationMessage = 'Are you sure you want to leave? Your quiz progress will be lost.';
            e.returnValue = confirmationMessage;
            return confirmationMessage;
        });

        // Handle page visibility change (tab switching, etc.)
        document.addEventListener('visibilitychange', function() {
            if (document.hidden && !document.getElementById('quizScreen').classList.contains('hidden')) {
                console.log('User switched tabs during quiz at:', new Date().toISOString());
                // You could implement additional security measures here
            }
        });
    </script>
</body>
</html>