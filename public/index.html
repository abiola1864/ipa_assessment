<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IPA Technical Assessment Quiz</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f5f5f5;
            line-height: 1.6;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }

        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            padding: 40px;
            margin-bottom: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .logo-section {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 30px;
        }

        .ipa-logo {
            max-width: 220px;
            height: auto;
            filter: drop-shadow(0 2px 10px rgba(0,0,0,0.1));
        }

        .header h1 {
            color: #11853d;
            font-size: 2.8em;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .header .subtitle {
            color: #666;
            font-size: 1.2em;
            margin-bottom: 10px;
            font-weight: 500;
        }

        .organization-info {
            background: linear-gradient(135deg, #f8fffe 0%, #e8f5f0 100%);
            border-left: 5px solid #11853d;
            padding: 25px;
            margin-bottom: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(17, 133, 61, 0.1);
        }

        .organization-info h4 {
            color: #11853d;
            margin-bottom: 12px;
            font-size: 1.2em;
            font-weight: 600;
        }

        .organization-info p {
            color: #555;
            font-size: 15px;
            margin: 0;
            line-height: 1.7;
        }

        .timer {
            background: #ff4444;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 1.2em;
            font-weight: bold;
            float: right;
            box-shadow: 0 2px 10px rgba(255, 68, 68, 0.3);
        }

        .progress-bar {
            width: 100%;
            height: 12px;
            background: #e0e0e0;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #11853d 0%, #16a852 100%);
            border-radius: 6px;
            transition: width 0.3s ease;
        }

        .question-info {
            color: #666;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .question {
            font-size: 1.2em;
            margin-bottom: 30px;
            line-height: 1.7;
            white-space: pre-line;
            color: #333;
        }

        .options {
            list-style: none;
            margin-bottom: 30px;
        }

        .option {
            margin-bottom: 15px;
            padding: 18px;
            border: 2px solid #ddd;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }

        .option:hover {
            border-color: #11853d;
            background: #f8fffe;
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(17, 133, 61, 0.1);
        }

        .option.selected {
            border-color: #11853d;
            background: linear-gradient(135deg, #f8fffe 0%, #e8f5f0 100%);
            box-shadow: 0 4px 15px rgba(17, 133, 61, 0.2);
        }

        .option input[type="radio"] {
            margin-right: 12px;
            transform: scale(1.2);
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 30px;
        }

        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary {
            background: linear-gradient(135deg, #11853d 0%, #16a852 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(17, 133, 61, 0.3);
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(17, 133, 61, 0.4);
        }

        .btn-secondary {
            background: #666;
            color: white;
        }

        .btn-secondary:hover:not(:disabled) {
            background: #555;
            transform: translateY(-1px);
        }

        .btn-danger {
            background: #ff4444;
            color: white;
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .question-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-top: 20px;
            justify-content: center;
        }

        .question-number {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-weight: bold;
            border: 2px solid #ddd;
            background: white;
            transition: all 0.3s ease;
        }

        .question-number:hover {
            transform: scale(1.1);
        }

        .question-number.answered {
            background: #11853d;
            color: white;
            border-color: #11853d;
        }

        .question-number.current {
            background: #2196F3;
            color: white;
            border-color: #2196F3;
            transform: scale(1.15);
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #11853d;
        }

        .form-group input {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus {
            outline: none;
            border-color: #11853d;
            box-shadow: 0 0 0 3px rgba(17, 133, 61, 0.1);
        }

        .quiz-info {
            background: linear-gradient(135deg, #e3f2fd 0%, #f8fbff 100%);
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
            border: 1px solid #e1f5fe;
        }

        .quiz-info h3 {
            color: #1976d2;
            margin-bottom: 20px;
            font-size: 1.3em;
            font-weight: 600;
        }

        .quiz-info ul {
            margin-left: 20px;
        }

        .quiz-info li {
            margin-bottom: 10px;
            color: #1976d2;
            font-weight: 500;
        }

        .completion-card {
            text-align: center;
            padding: 50px;
        }

        .completion-icon {
            font-size: 5em;
            margin-bottom: 25px;
        }

        .score-display {
            background: linear-gradient(135deg, #f5f5f5 0%, #fff 100%);
            padding: 40px;
            border-radius: 15px;
            margin: 25px 0;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .score-number {
            font-size: 3.5em;
            font-weight: bold;
            color: #11853d;
        }

        .grade-badge {
            padding: 12px 24px;
            border-radius: 25px;
            color: white;
            font-weight: bold;
            margin-top: 15px;
            display: inline-block;
            font-size: 1.1em;
        }

        .excellent { background: linear-gradient(135deg, #11853d 0%, #16a852 100%); }
        .good { background: linear-gradient(135deg, #FF9800 0%, #FFC107 100%); }
        .needs-improvement { background: linear-gradient(135deg, #f44336 0%, #e57373 100%); }

        .validation-error {
            background: #ffebee;
            color: #c62828;
            padding: 18px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #f44336;
            font-weight: 500;
        }

        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #11853d;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .submission-status {
            background: #e8f5e8;
            color: #2e7d2e;
            padding: 18px;
            border-radius: 8px;
            margin-top: 20px;
            border-left: 4px solid #11853d;
        }

        .detailed-results {
            text-align: left;
            margin-top: 30px;
            padding: 25px;
            background: #f9f9f9;
            border-radius: 12px;
        }

        .result-question {
            margin-bottom: 25px;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #ddd;
        }

        .result-question.correct {
            background: #e8f5e8;
            border-left-color: #11853d;
        }

        .result-question.incorrect {
            background: #ffebee;
            border-left-color: #f44336;
        }

        .result-question h4 {
            margin-bottom: 12px;
            color: #333;
            font-weight: 600;
        }

        .result-details {
            font-size: 14px;
            margin-top: 10px;
        }

        .your-answer {
            color: #f44336;
            font-weight: bold;
        }

        .correct-answer {
            color: #11853d;
            font-weight: bold;
        }

        .explanation {
            background: #f0f0f0;
            padding: 12px;
            border-radius: 6px;
            margin-top: 10px;
            font-style: italic;
            line-height: 1.5;
        }

        .hidden {
            display: none;
        }

        .footer-logos {
            text-align: center;
            margin-top: 50px;
            padding-top: 30px;
            border-top: 1px solid #eee;
        }

        .footer-logos p {
            color: #666;
            font-size: 14px;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .card {
                padding: 25px;
            }
            
            .timer {
                float: none;
                display: block;
                text-align: center;
                margin-bottom: 20px;
            }
            
            .question-grid {
                justify-content: center;
            }

            .ipa-logo {
                max-width: 180px;
            }

            .header h1 {
                font-size: 2.2em;
            }

            .organization-info {
                padding: 20px;
            }

            .quiz-info {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Start Screen -->
        <div id="startScreen" class="card">
            <div class="header">
            <!-- Logo Section -->
<!-- Logo Section -->
<div class="logo-section">
    <!-- IPA Logo -->
   <img src="images/ipalogo.png" 
     alt="IPA - Innovations for Poverty Action" 
     class="ipa-logo">

</div>



                <h1>Technical Assessment</h1>
                <p class="subtitle">Innovations for Poverty Action</p>
            </div>

            <!-- Organization Information -->
            <div class="organization-info">
                <h4>Assessment Overview</h4>
                <p>This technical assessment evaluates expertise in data analysis, monitoring & evaluation, impact evaluation methodology, and programming logic for evidence-based research and policy implementation.</p>
            </div>

            <div class="quiz-info">
                <h3>Assessment Information:</h3>
                <ul>
                    <li>20 Multiple Choice Questions</li>
                    <li>30 Minutes Time Limit</li>
                    <li>40% Data Analysis, 25% M&E/Impact Evaluation, 35% Programming Logic</li>
                    <li>Tests expertise in research methodology and implementation</li>
                    <li>Covers statistical analysis, evaluation design, and technical problem-solving</li>
                    <li>All questions are required</li>
                    <li>Detailed results with explanations provided at the end</li>
                    <li>You can move between questions before submitting</li>
                </ul>
            </div>

            <div class="form-group">
                <label for="participantName">Your Full Name:</label>
                <input type="text" id="participantName" placeholder="Enter your full name" maxlength="50">
            </div>

            <div style="text-align: center;">
                <button class="btn btn-primary" onclick="startQuiz()" id="startBtn">
                    Start Assessment
                </button>
            </div>
        </div>

        <!-- Quiz Screen -->
        <div id="quizScreen" class="hidden">
            <!-- Header -->
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <div>
                        <h2 id="questionTitle">Question 1 of 20</h2>
                        <div class="question-info" id="questionInfo">Loading...</div>
                    </div>
                    <div class="timer" id="timer">30:00</div>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 5%;"></div>
                </div>
            </div>

            <!-- Question -->
            <div class="card">
                <div id="validationError" class="validation-error hidden">
                    ⚠️ Please select an answer before proceeding to the next question.
                </div>

                <div class="question" id="questionText">
                    Loading question...
                </div>

                <ul class="options" id="optionsList">
                    <!-- Options will be populated by JavaScript -->
                </ul>

                <div class="navigation">
                    <button class="btn btn-secondary" onclick="prevQuestion()" id="prevBtn" disabled>
                        Previous
                    </button>
                    
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-primary" onclick="nextQuestion()" id="nextBtn">
                            Next
                        </button>
                        <button class="btn btn-danger hidden" onclick="submitQuiz()" id="submitBtn">
                            Submit Assessment
                        </button>
                    </div>
                </div>

                <!-- Question Navigation Grid -->
                <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #ddd;">
                    <p style="margin-bottom: 15px; color: #666;">Question Status:</p>
                    <div class="question-grid" id="questionGrid">
                        <!-- Question numbers will be populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Completion Screen -->
        <div id="completionScreen" class="hidden">
            <div class="card completion-card">
                <div class="completion-icon" id="completionIcon">🎉</div>
                <h2>Assessment Completed!</h2>
                <p id="thankYouMessage">Thank you for completing the technical assessment!</p>

                <div class="score-display">
                    <div class="score-number" id="finalScore">20/20</div>
                    <div style="font-size: 1.5em; margin: 10px 0;" id="finalPercentage">100%</div>
                    <div class="grade-badge excellent" id="gradeBadge">Excellent</div>
                </div>

                <div id="submissionStatus" class="submission-status hidden">
                    <div class="loading-spinner" id="loadingSpinner"></div>
                    <p id="statusMessage">Submitting your results...</p>
                </div>

                <!-- Detailed Results Section -->
                <div id="detailedResultsContainer" class="detailed-results">
                    <h3 style="margin-bottom: 20px; text-align: center;">Detailed Results</h3>
                    <div id="detailedResultsList">
                        <!-- Will be populated by JavaScript -->
                    </div>
                </div>

                <p style="margin-top: 30px; color: #666; font-size: 14px;">
                    Your results have been saved to the database for analysis and reporting purposes.
                </p>

                <div style="margin-top: 30px;">
                    <button class="btn btn-primary" onclick="resetQuiz()" id="resetBtn">
                        Take Assessment Again
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Technical assessment questions
      // Consumer Protection Technical Assessment Questions
const questions = [



{
    id: 1,
    category: 'Data Analysis',
    skill: 'Understanding Confounding Variables',
    question: 'You want to prove telecom towers improve satisfaction by comparing Lagos (8,500 towers, 82% satisfaction) with Kebbi (150 towers, 31% satisfaction). Your boss says "This comparison has problems." What is the most likely issue?',
    options: [
        'Wealthier states attract more towers and their consumers tend to be more satisfied',
        'Areas with stronger infrastructure (roads, electricity) both enable more towers and create better customer experiences',
        'Regions with higher education levels both demand more telecom services and report higher satisfaction',
        'More urbanized states both support more tower investment and provide conditions for higher satisfaction'
    ],
    correct: 'A',
    explanation: 'This is a confounding problem: Lagos is wealthier, and wealth is linked to both more tower investment and higher satisfaction. Without controlling for wealth (and related factors), you cannot isolate the true effect of towers.'
},

    // Data Analysis Questions (8)

    {
        id: 2,
        category: 'Data Analysis',
        skill: 'Excel Pivot Table Analysis',
        question: 'You have 50,000 complaint records and need a report showing average resolution days by service type and region. What is the most efficient approach in Excel?',
        options: [
            'VLOOKUP functions to match service types with resolution times',
            'Pivot Tables to automatically calculate averages across multiple categories',
            'Conditional formatting to highlight resolution times above average',
            'Data validation to filter records by service type and region'
        ],
        correct: 'B',
        explanation: 'Pivot Tables are designed for this type of multidimensional analysis, automatically calculating averages across service types and regions. Other options require manual work or don\'t perform the necessary calculations.'
    },
    {
        id: 3,
        category: 'Data Analysis',
        skill: 'Statistical vs Practical Significance',
        question: 'Your campaign improved knowledge from 62% to 64% with 45,000 people surveyed (p<0.001). Your manager says "Great results!" What should you consider about this finding?',
        options: [
            'The sample size is too large, making the test unreliable',
            'Small p-values only mean the result isn\'t due to chance, not that the 2% improvement is meaningful',
            'We need to check if the data meets the assumptions for this test',
            'The confidence interval would give more accurate information than the p-value'
        ],
        correct: 'B',
        explanation: 'Statistical significance (p<0.001) only indicates the result is unlikely due to chance. With large samples, even tiny differences become statistically significant. Whether 2% improvement matters for policy is a separate question about practical significance.'
    },
    {
        id: 4,
        category: 'Data Analysis',
        skill: 'Self-Selection Bias Recognition',
        question: 'Your data shows online complaint users get 45% faster resolution than phone users. Before recommending everyone switch to online, what should concern you most?',
        options: [
            'Online systems may record timestamps differently than phone systems',
            'People who choose online forms may be systematically different from phone users',
            'The sample sizes for online and phone users may not be equal',
            'Seasonal patterns may affect online and phone complaint resolution differently'
        ],
        correct: 'B',
        explanation: 'Self-selection bias is the key concern - online users likely differ systematically in tech skills, writing ability, and persistence. These user characteristics, not the channel itself, may drive the faster resolution.'
    },
    {
        id: 5,
        category: 'Data Analysis',
        skill: 'Understanding Simpson\'s Paradox',
        question: 'Provider A has higher resolution rates than B for billing complaints (85% vs 80%) AND service complaints (90% vs 85%), yet has lower overall resolution (75% vs 78%). How is this possible?',
        options: [
            'There are systematic errors in how resolution rates are calculated',
            'Provider A handles different proportions of complaint types than Provider B',
            'The confidence intervals for these estimates likely overlap significantly',
            'Outlier complaints are affecting the averages differently for each provider'
        ],
        correct: 'B',
        explanation: 'This is Simpson\'s Paradox. Provider A excels in both categories but handles more difficult billing complaints (lower base resolution rate), while Provider B handles more easier service complaints, affecting overall averages despite A\'s category-level superiority.'
    },
    {
        id: 6,
        category: 'Data Analysis',
        skill: 'Measurement Error Impact',
        question: 'You\'re studying how income affects telecom spending using survey data where people typically underreport their income. How does this affect your analysis?',
        options: [
            'Creates systematic bias by shifting all income values downward',
            'Makes the income-spending relationship appear weaker than it actually is',
            'Reduces statistical power by effectively decreasing the sample size',
            'Violates the independence assumption needed for correlation analysis'
        ],
        correct: 'B',
        explanation: 'Measurement error in predictor variables (income) creates attenuation bias, making observed correlations weaker than the true relationships. This affects your ability to detect real income-spending patterns.'
    },
    {
        id: 7,
        category: 'Data Analysis',
        skill: 'Base Rate Understanding',
        question: 'Your fraud detection system catches 92% of fraudulent accounts and has 6% false alarms. In a market where only 0.3% of accounts are fraudulent, what will most flagged accounts actually be?',
        options: [
            'Fraudulent accounts because the 92% detection rate is very high',
            'Legitimate accounts because false alarms outnumber true fraud when fraud is rare',
            'About evenly split between fraudulent and legitimate accounts',
            'Cannot be determined without knowing the negative predictive value'
        ],
        correct: 'B',
        explanation: 'With very low fraud rates (0.3%), the 6% false alarm rate applied to 99.7% legitimate accounts creates far more false positives than the actual fraud cases detected, despite the high sensitivity.'
    },
    {
        id: 8,
        category: 'Data Analysis',
        skill: 'Regression to the Mean',
        question: 'After training, your worst-performing centers improved dramatically while top centers barely changed. What should you consider before crediting the training?',
        options: [
            'Ceiling effects may prevent top performers from showing additional improvement',
            'Extreme scores naturally tend to become more average on repeat measurement',
            'The training materials may have been designed specifically for poor performers',
            'Measurement reliability may be lower for extreme performance scores'
        ],
        correct: 'B',
        explanation: 'Regression to the mean explains why extreme performers (good or bad) tend to move toward average on remeasurement due to natural statistical variation, independent of any intervention effect.'
    },

    // M&E Questions (5)
    {
        id: 9,
        category: 'M&E',
        skill: 'Pre-test and Post-test Purpose',
        question: 'You want to demonstrate that your consumer education program improved knowledge. Why is measuring knowledge only after the program insufficient?',
        options: [
            'Post-only designs lack sufficient statistical power to detect program effects',
            'You cannot determine how much knowledge changed without knowing the starting point',
            'Single measurement cannot establish the proper temporal sequence',
            'Post-test responses may be biased by social desirability effects'
        ],
        correct: 'B',
        explanation: 'Without baseline measurement, you cannot attribute observed knowledge levels to the program versus pre-existing knowledge. Pre-post comparison is necessary to measure actual change and isolate program impact.'
    },
    {
        id: 10,
        category: 'M&E',
        skill: 'Output vs Outcome vs Impact Distinction',
        question: 'Your program achieved: 85% gained knowledge, 68% changed behavior, 15% system-wide complaint reduction. Which represents what the program directly produced?',
        options: [
            'The 15% system change because it shows the program\'s ultimate effectiveness',
            'The 85% knowledge gain because this is what training sessions directly created',
            'All three results equally demonstrate program accomplishments',
            'The 68% behavior change because it proves the program worked as intended'
        ],
        correct: 'B',
        explanation: 'In the results chain: outputs are immediate products (knowledge from training), outcomes are subsequent changes (behavior), impacts are broader effects (system-wide changes). Knowledge is the direct program product.'
    },
    {
        id: 11,
        category: 'M&E',
        skill: 'Complex Outcome Measurement',
        question: 'You need to measure whether consumers are "empowered" to handle telecom issues. What is the main limitation of using only satisfaction surveys?',
        options: [
            'Satisfaction surveys typically have response rates too low for reliable measurement',
            'Empowerment includes multiple dimensions that one indicator cannot fully capture',
            'Satisfaction questions often contain wording that creates measurement bias',
            'Survey data collection costs too much for routine program monitoring'
        ],
        correct: 'B',
        explanation: 'Complex constructs like "empowerment" require multiple indicators across different dimensions (knowledge, behavior, capacity, outcomes). Single measures, regardless of quality, cannot capture multidimensional concepts adequately.'
    },
    {
        id: 12,
        category: 'M&E',
        skill: 'Monitoring vs Evaluation Distinction',
        question: 'For 6 months, you\'ve been tracking training sessions, participant numbers, and immediate feedback scores. What type of M&E activity is this?',
        options: [
            'Evaluation because you are measuring program performance over time',
            'Monitoring because you are tracking ongoing implementation activities and immediate outputs',
            'Baseline research because you are establishing program performance benchmarks',
            'Cost-effectiveness analysis because you are tracking resource use over time'
        ],
        correct: 'B',
        explanation: 'This describes monitoring - regular tracking of implementation activities and immediate outputs. Evaluation would examine whether the program achieved its intended outcomes and impacts, typically done periodically.'
    },
    {
        id: 13,
        category: 'M&E',
        skill: 'Logical Framework Design',
        question: 'Your program logic: train staff → faster response → higher satisfaction. What should you measure first to track program progress?',
        options: [
            'Consumer satisfaction scores across the telecom sector',
            'Average response times from all service providers',
            'Number of customer service staff who completed training',
            'Cost per complaint resolved before and after training'
        ],
        correct: 'C',
        explanation: 'Following the logical framework sequence, you measure outputs (staff trained) first, then outcomes (response times), then impacts (satisfaction). Outputs are the immediate, directly measurable products of program activities.'
    },

    // RCT/Impact Evaluation Questions (3)
    {
        id: 14,
        category: 'RCT/Impact',
        skill: 'Randomization Unit Trade-offs',
        question: 'You\'re testing complaint resolution across 300 centers in 50 cities. You could randomly assign individual centers or entire cities to treatment. What is the main advantage of city-level randomization?',
        options: [
            'City randomization provides larger sample sizes for statistical analysis',
            'City randomization prevents centers from learning practices from nearby treated centers',
            'City randomization improves the representativeness of the sample',
            'City randomization reduces the complexity of implementation logistics'
        ],
        correct: 'B',
        explanation: 'City-level (cluster) randomization prevents spillover effects where treated centers share new practices with nearby control centers. This contamination prevention is the key methodological advantage, though it reduces statistical power.'
    },
    {
        id: 15,
        category: 'RCT/Impact',
        skill: 'Intent-to-Treat Analysis Logic',
        question: 'In your RCT, 78% of treatment group attended training while 22% of controls got similar training elsewhere. For policy decisions, which analysis approach is most useful?',
        options: [
            'Per-protocol analysis comparing actual training participants versus pure controls',
            'Intent-to-treat analysis comparing original assignments regardless of participation',
            'As-treated analysis comparing everyone who got training versus those who didn\'t',
            'Dose-response analysis examining effects by hours of training received'
        ],
        correct: 'B',
        explanation: 'Intent-to-treat analysis preserves randomization and estimates the effect of offering the program, including real-world non-compliance that will occur during policy implementation.'
    },
    {
        id: 16,
        category: 'RCT/Impact',
        skill: 'External Validity vs Research Conditions',
        question: 'Your closely monitored pilot program achieved 85% complaint resolution, but national rollout achieved only 45%. What most likely explains this large difference?',
        options: [
            'National implementation teams had lower qualifications than pilot staff',
            'Research monitoring created performance conditions not replicable in normal operations',
            'The complaint types changed between pilot and rollout periods',
            'Budget constraints limited resources available for national implementation'
        ],
        correct: 'B',
        explanation: 'Hawthorne effects from intensive research monitoring, frequent check-ins, and special attention often create artificially high performance that cannot be sustained under normal operating conditions without researchers present.'
    },

    // Programming Logic Questions (4)
    {
        id: 17,
        category: 'Programming Logic',
        skill: 'Conditional Logic Programming',
        question: 'Code: if complaint_type == "billing" and amount > 10000: priority = "high"; elif complaint_type == "service" and downtime > 24: priority = "high"; else: priority = "normal". What priority does a service complaint with 30-hour downtime receive?',
        options: [
            'normal because the amount variable is undefined for service complaints',
            'high because it satisfies the service complaint condition in the elif statement',
            'error because the code tries to access an undefined amount variable',
            'depends on whether the priority variable was initialized before this code'
        ],
        correct: 'B',
        explanation: 'Following conditional logic: first if fails (complaint_type != "billing"), elif succeeds (complaint_type == "service" AND downtime > 24 both true), so priority = "high". The amount variable is never evaluated.'
    },
    {
        id: 18,
        category: 'Programming Logic',
        skill: 'Boolean Logic and Operators',
        question: 'Expression: (account_age < 6) AND (complaints != 0) AND NOT (resolved >= total). For account with age=3, complaints=5, resolved=5, total=5, what is the result?',
        options: [
            'True because the account meets the age and complaint criteria',
            'False because the NOT (resolved >= total) part evaluates to false',
            'Error because comparing resolved to total creates invalid logic',
            'Undefined because the expression contains contradictory conditions'
        ],
        correct: 'B',
        explanation: 'Evaluating: (3 < 6) = True, (5 != 0) = True, (5 >= 5) = True so NOT(True) = False. Complete expression: True AND True AND False = False. Account not flagged because all complaints are resolved.'
    },
    {
        id: 19,
        category: 'Programming Logic',
        skill: 'System Reliability Design',
        question: 'Your system processes 15,000 daily complaints from 10 data sources. Some sources occasionally fail, but you must produce daily reports regardless. What design approach ensures this?',
        options: [
            'Implement comprehensive logging to track all system operations',
            'Process each source independently so failures don\'t prevent other sources from completing',
            'Use database transactions to maintain consistency across all operations',
            'Set up automated alerts to notify administrators of any failures immediately'
        ],
        correct: 'B',
        explanation: 'Independent processing with failure isolation allows successful sources to complete while failed sources are retried, ensuring daily reports are generated even when some data sources have problems.'
    },
    {
        id: 20,
        category: 'Programming Logic',
        skill: 'Algorithm Optimization Strategy',
        question: 'Phone number searches take 55 seconds to scan through 8 million records sequentially. What change would provide the biggest performance improvement?',
        options: [
            'Use parallel processing to distribute searches across multiple processors',
            'Create an index structure for direct record lookup instead of scanning everything',
            'Add more memory to reduce the need for disk access during searches',
            'Optimize database connections to reduce network communication overhead'
        ],
        correct: 'B',
        explanation: 'Creating an index changes the algorithm from O(n) sequential scanning to O(log n) or O(1) direct lookup - a fundamental algorithmic improvement that typically provides 100x-1000x performance gains versus hardware optimizations.'
    }
];





        let currentQuestionIndex = 0;
        let answers = {};
        let participantName = '';
        let timeLeft = 1800; // 30 minutes in seconds
        let timerInterval;
        let quizStartTime;

        // Initialize the quiz
        function startQuiz() {
            const nameInput = document.getElementById('participantName');
            participantName = nameInput.value.trim();
            
            if (!participantName) {
                alert('Please enter your name before starting the assessment.');
                return;
            }

            if (participantName.length < 2) {
                alert('Please enter your full name (at least 2 characters).');
                return;
            }

            // Record start time
            quizStartTime = new Date();

            // Hide start screen, show quiz screen
            document.getElementById('startScreen').classList.add('hidden');
            document.getElementById('quizScreen').classList.remove('hidden');

            // Initialize quiz
            answers = {};
            currentQuestionIndex = 0;
            
            // Start timer
            startTimer();
            
            // Load first question
            loadQuestion();
            
            // Create question navigation grid
            createQuestionGrid();
        }

        function startTimer() {
            timerInterval = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    submitQuiz();
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            const timerElement = document.getElementById('timer');
            timerElement.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            
            // Change color when time is running out
            if (timeLeft <= 300) { // 5 minutes
                timerElement.style.background = '#ff4444';
            } else if (timeLeft <= 600) { // 10 minutes
                timerElement.style.background = '#ff8800';
            }
        }

        function loadQuestion() {
            const question = questions[currentQuestionIndex];
            
            // Update question title and info
            document.getElementById('questionTitle').textContent = `Question ${currentQuestionIndex + 1} of ${questions.length}`;
            document.getElementById('questionInfo').textContent = `${question.category}`;
            
            // Update question text
            document.getElementById('questionText').textContent = question.question;
            
            // Update progress bar
            const progress = ((currentQuestionIndex + 1) / questions.length) * 100;
            document.getElementById('progressFill').style.width = `${progress}%`;
            
            // Create options
            const optionsList = document.getElementById('optionsList');
            optionsList.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const optionLetter = String.fromCharCode(65 + index); // A, B, C, D
                const li = document.createElement('li');
                li.className = 'option';
                
                const isSelected = answers[question.id] === optionLetter;
                if (isSelected) {
                    li.classList.add('selected');
                }
                
                li.innerHTML = `
                    <input type="radio" name="question${question.id}" value="${optionLetter}" ${isSelected ? 'checked' : ''}>
                    <span style="font-weight: bold; margin-right: 10px;">${optionLetter}.</span>
                    ${option}
                `;
                
                li.addEventListener('click', () => selectOption(question.id, optionLetter));
                optionsList.appendChild(li);
            });
            
            // Update navigation buttons
            updateNavigationButtons();
            updateQuestionGrid();
            
            // Hide validation error
            document.getElementById('validationError').classList.add('hidden');
        }

        function selectOption(questionId, optionLetter) {
            answers[questionId] = optionLetter;
            
            // Update visual selection
            const optionsList = document.getElementById('optionsList');
            const options = optionsList.querySelectorAll('.option');
            options.forEach(option => option.classList.remove('selected'));
            
            const selectedOption = [...options].find(opt => 
                opt.querySelector('input').value === optionLetter
            );
            if (selectedOption) {
                selectedOption.classList.add('selected');
                selectedOption.querySelector('input').checked = true;
            }
            
            updateQuestionGrid();
            
            // Hide validation error if it was showing
            document.getElementById('validationError').classList.add('hidden');
        }

        function nextQuestion() {
            const currentQuestion = questions[currentQuestionIndex];
            
            // Check if current question is answered (mandatory)
            if (!answers[currentQuestion.id]) {
                document.getElementById('validationError').classList.remove('hidden');
                return;
            }
            
            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                loadQuestion();
            }
        }

        function prevQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                loadQuestion();
            }
        }

        function goToQuestion(index) {
            currentQuestionIndex = index;
            loadQuestion();
        }

        function updateNavigationButtons() {
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const submitBtn = document.getElementById('submitBtn');
            
            prevBtn.disabled = currentQuestionIndex === 0;
            
            if (currentQuestionIndex === questions.length - 1) {
                nextBtn.classList.add('hidden');
                submitBtn.classList.remove('hidden');
            } else {
                nextBtn.classList.remove('hidden');
                submitBtn.classList.add('hidden');
            }
        }

        function createQuestionGrid() {
            const grid = document.getElementById('questionGrid');
            grid.innerHTML = '';
            
            for (let i = 0; i < questions.length; i++) {
                const questionNum = document.createElement('div');
                questionNum.className = 'question-number';
                questionNum.textContent = i + 1;
                questionNum.onclick = () => goToQuestion(i);
                grid.appendChild(questionNum);
            }
            
            updateQuestionGrid();
        }

        function updateQuestionGrid() {
            const questionNumbers = document.querySelectorAll('.question-number');
            questionNumbers.forEach((num, index) => {
                num.className = 'question-number';
                
                if (index === currentQuestionIndex) {
                    num.classList.add('current');
                } else if (answers[questions[index].id]) {
                    num.classList.add('answered');
                }
            });
        }

        function createDetailedResults(score, total) {
            const container = document.getElementById('detailedResultsList');
            container.innerHTML = '';

            let correctCount = 0;
            let incorrectCount = 0;

            questions.forEach(question => {
                const userAnswer = answers[question.id];
                const isCorrect = userAnswer === question.correct;
                
                if (isCorrect) {
                    correctCount++;
                } else {
                    incorrectCount++;
                }

                const resultDiv = document.createElement('div');
                resultDiv.className = `result-question ${isCorrect ? 'correct' : 'incorrect'}`;
                
                const optionTexts = {};
                question.options.forEach((option, index) => {
                    optionTexts[String.fromCharCode(65 + index)] = option;
                });

                resultDiv.innerHTML = `
                    <h4>Question ${question.id}: ${question.category}</h4>
                    <p style="margin-bottom: 10px;">${question.question}</p>
                    <div class="result-details">
                        ${!isCorrect ? `<p><span class="your-answer">Your answer: ${userAnswer}.</span> ${optionTexts[userAnswer]}</p>` : ''}
                        <p><span class="correct-answer">Correct answer: ${question.correct}.</span> ${optionTexts[question.correct]}</p>
                        <div class="explanation">
                            <strong>Explanation:</strong> ${question.explanation}
                        </div>
                    </div>
                `;
                
                container.appendChild(resultDiv);
            });

            // Add summary at the top
            const summaryDiv = document.createElement('div');
            summaryDiv.style.cssText = 'margin-bottom: 20px; padding: 15px; background: #e3f2fd; border-radius: 6px; text-align: center;';
            summaryDiv.innerHTML = `
                <h4 style="color: #1976d2; margin-bottom: 10px;">Results Summary</h4>
                <p><strong>Correct:</strong> ${correctCount} questions | <strong>Incorrect:</strong> ${incorrectCount} questions</p>
                <p style="margin-top: 8px; font-size: 14px; color: #666;">
                    ${incorrectCount > 0 ? 'Review the incorrect answers below to learn more.' : 'Perfect score! Excellent work.'}
                </p>
            `;
            container.insertBefore(summaryDiv, container.firstChild);
        }

        async function submitQuiz() {
            // Check if all questions are answered
            const unansweredQuestions = [];
            questions.forEach(q => {
                if (!answers[q.id]) {
                    unansweredQuestions.push(q.id);
                }
            });
            
            if (unansweredQuestions.length > 0) {
                alert(`Please answer all questions before submitting. Missing: Question(s) ${unansweredQuestions.join(', ')}`);
                return;
            }
            
            // Calculate score and time taken
            let score = 0;
            questions.forEach(q => {
                if (answers[q.id] === q.correct) {
                    score++;
                }
            });

            const quizEndTime = new Date();
            const timeTakenSeconds = Math.floor((quizEndTime - quizStartTime) / 1000);
            
            // Stop timer
            clearInterval(timerInterval);
            
            // Show completion screen first
            showCompletionScreen(score, questions.length);
            
            // Create detailed results
            createDetailedResults(score, questions.length);
            
            // Prepare data for submission
            const quizResult = {
                participant_name: participantName,
                completed_at: quizEndTime.toISOString(),
                total_score: score,
                percentage: Math.round((score / questions.length) * 100),
                time_taken: timeTakenSeconds
            };
            
            // Add individual question responses
            questions.forEach(q => {
                quizResult[`Q${q.id}`] = answers[q.id] || '';
                quizResult[`Q${q.id}_correct`] = q.correct;
                quizResult[`Q${q.id}_skill`] = q.skill;
                quizResult[`Q${q.id}_category`] = q.category;
            });
            
            // Submit to backend
            await submitToDatabase(quizResult);
        }

        async function submitToDatabase(data) {
            const statusDiv = document.getElementById('submissionStatus');
            const statusMessage = document.getElementById('statusMessage');
            const loadingSpinner = document.getElementById('loadingSpinner');
            
            // Show submission status
            statusDiv.classList.remove('hidden');
            statusMessage.textContent = 'Submitting your results...';
            loadingSpinner.style.display = 'block';
            
            console.log('Attempting to submit assessment data:', data);
            
            try {
                const response = await fetch('/api/submit-quiz', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });
                
                console.log('Response received:', response.status, response.statusText);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('HTTP Error:', response.status, errorText);
                    throw new Error(`HTTP ${response.status}: ${errorText}`);
                }
                
                const result = await response.json();
                console.log('Success response:', result);
                
                if (result.success) {
                    // Success
                    loadingSpinner.style.display = 'none';
                    statusMessage.textContent = `Results successfully saved! (ID: ${result.id})`;
                    statusDiv.style.background = '#e8f5e8';
                    statusDiv.style.color = '#2e7d2e';
                    statusDiv.style.borderLeftColor = '#11853d';
                    
                    console.log('Assessment submitted successfully:', result);
                } else {
                    throw new Error(result.error || 'Submission failed');
                }
            } catch (error) {
                console.error('Error submitting assessment:', error);
                
                // Show error but don't prevent completion
                loadingSpinner.style.display = 'none';
                statusMessage.textContent = `Warning: Results may not have been saved. Error: ${error.message}. Please inform the administrator.`;
                statusDiv.style.background = '#fff3e0';
                statusDiv.style.color = '#e65100';
                statusDiv.style.borderLeftColor = '#ff9800';
            }
        }

        function showCompletionScreen(score, total) {
            const percentage = Math.round((score / total) * 100);
            
            // Hide quiz screen, show completion screen
            document.getElementById('quizScreen').classList.add('hidden');
            document.getElementById('completionScreen').classList.remove('hidden');
            
            // Update completion screen
            document.getElementById('finalScore').textContent = `${score}/${total}`;
            document.getElementById('finalPercentage').textContent = `${percentage}%`;
            document.getElementById('thankYouMessage').textContent = `Thank you, ${participantName}!`;
            
            // Set icon and grade
            const icon = document.getElementById('completionIcon');
            const badge = document.getElementById('gradeBadge');
            
            if (percentage >= 80) {
                icon.textContent = '🎉';
                badge.textContent = 'Excellent';
                badge.className = 'grade-badge excellent';
            } else if (percentage >= 60) {
                icon.textContent = '👍';
                badge.textContent = 'Good';
                badge.className = 'grade-badge good';
            } else {
                icon.textContent = '📚';
                badge.textContent = 'Needs Improvement';
                badge.className = 'grade-badge needs-improvement';
            }
        }

        function resetQuiz() {
            // Reset all variables
            currentQuestionIndex = 0;
            answers = {};
            participantName = '';
            timeLeft = 2100;
            quizStartTime = null;
            
            // Clear timer
            clearInterval(timerInterval);
            
            // Reset form
            document.getElementById('participantName').value = '';
            
            // Hide status message
            document.getElementById('submissionStatus').classList.add('hidden');
            
            // Show start screen
            document.getElementById('completionScreen').classList.add('hidden');
            document.getElementById('startScreen').classList.remove('hidden');
        }

        // Initialize when page loads
        window.addEventListener('load', () => {
            console.log('IPA Technical Assessment loaded successfully');
            console.log('Questions available:', questions.length);
            console.log('Focus areas: Data Analysis, M&E, RCT/Impact, Programming Logic');
        });

        // Prevent accidental page refresh during quiz
        window.addEventListener('beforeunload', function (e) {
            if (document.getElementById('quizScreen').classList.contains('hidden')) {
                return; // Quiz not in progress
            }
            
            const confirmationMessage = 'Are you sure you want to leave? Your assessment progress will be lost.';
            e.returnValue = confirmationMessage;
            return confirmationMessage;
        });

        // Handle page visibility change (tab switching, etc.)
        document.addEventListener('visibilitychange', function() {
            if (document.hidden && !document.getElementById('quizScreen').classList.contains('hidden')) {
                console.log('User switched tabs during assessment at:', new Date().toISOString());
                // You could implement additional security measures here
            }
        });
    </script>
</body>
</html>