<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IPA Technical Assessment Quiz</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f5f5f5;
            line-height: 1.6;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }

        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            padding: 40px;
            margin-bottom: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .logo-section {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 30px;
        }

        .ipa-logo {
            max-width: 220px;
            height: auto;
            filter: drop-shadow(0 2px 10px rgba(0,0,0,0.1));
        }

        .header h1 {
            color: #11853d;
            font-size: 2.8em;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .header .subtitle {
            color: #666;
            font-size: 1.2em;
            margin-bottom: 10px;
            font-weight: 500;
        }

        .organization-info {
            background: linear-gradient(135deg, #f8fffe 0%, #e8f5f0 100%);
            border-left: 5px solid #11853d;
            padding: 25px;
            margin-bottom: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(17, 133, 61, 0.1);
        }

        .organization-info h4 {
            color: #11853d;
            margin-bottom: 12px;
            font-size: 1.2em;
            font-weight: 600;
        }

        .organization-info p {
            color: #555;
            font-size: 15px;
            margin: 0;
            line-height: 1.7;
        }

        .timer {
            background: #ff4444;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 1.2em;
            font-weight: bold;
            float: right;
            box-shadow: 0 2px 10px rgba(255, 68, 68, 0.3);
        }

        .progress-bar {
            width: 100%;
            height: 12px;
            background: #e0e0e0;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #11853d 0%, #16a852 100%);
            border-radius: 6px;
            transition: width 0.3s ease;
        }

        .question-info {
            color: #666;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .question {
            font-size: 1.2em;
            margin-bottom: 30px;
            line-height: 1.7;
            white-space: pre-line;
            color: #333;
        }

        .options {
            list-style: none;
            margin-bottom: 30px;
        }

        .option {
            margin-bottom: 15px;
            padding: 18px;
            border: 2px solid #ddd;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }

        .option:hover {
            border-color: #11853d;
            background: #f8fffe;
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(17, 133, 61, 0.1);
        }

        .option.selected {
            border-color: #11853d;
            background: linear-gradient(135deg, #f8fffe 0%, #e8f5f0 100%);
            box-shadow: 0 4px 15px rgba(17, 133, 61, 0.2);
        }

        .option input[type="radio"] {
            margin-right: 12px;
            transform: scale(1.2);
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 30px;
        }

        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary {
            background: linear-gradient(135deg, #11853d 0%, #16a852 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(17, 133, 61, 0.3);
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(17, 133, 61, 0.4);
        }

        .btn-secondary {
            background: #666;
            color: white;
        }

        .btn-secondary:hover:not(:disabled) {
            background: #555;
            transform: translateY(-1px);
        }

        .btn-danger {
            background: #ff4444;
            color: white;
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .question-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-top: 20px;
            justify-content: center;
        }

        .question-number {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-weight: bold;
            border: 2px solid #ddd;
            background: white;
            transition: all 0.3s ease;
        }

        .question-number:hover {
            transform: scale(1.1);
        }

        .question-number.answered {
            background: #11853d;
            color: white;
            border-color: #11853d;
        }

        .question-number.current {
            background: #2196F3;
            color: white;
            border-color: #2196F3;
            transform: scale(1.15);
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #11853d;
        }

        .form-group input {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus {
            outline: none;
            border-color: #11853d;
            box-shadow: 0 0 0 3px rgba(17, 133, 61, 0.1);
        }

        .quiz-info {
            background: linear-gradient(135deg, #e3f2fd 0%, #f8fbff 100%);
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
            border: 1px solid #e1f5fe;
        }

        .quiz-info h3 {
            color: #1976d2;
            margin-bottom: 20px;
            font-size: 1.3em;
            font-weight: 600;
        }

        .quiz-info ul {
            margin-left: 20px;
        }

        .quiz-info li {
            margin-bottom: 10px;
            color: #1976d2;
            font-weight: 500;
        }

        .completion-card {
            text-align: center;
            padding: 50px;
        }

        .completion-icon {
            font-size: 5em;
            margin-bottom: 25px;
        }

        .score-display {
            background: linear-gradient(135deg, #f5f5f5 0%, #fff 100%);
            padding: 40px;
            border-radius: 15px;
            margin: 25px 0;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .score-number {
            font-size: 3.5em;
            font-weight: bold;
            color: #11853d;
        }

        .grade-badge {
            padding: 12px 24px;
            border-radius: 25px;
            color: white;
            font-weight: bold;
            margin-top: 15px;
            display: inline-block;
            font-size: 1.1em;
        }

        .excellent { background: linear-gradient(135deg, #11853d 0%, #16a852 100%); }
        .good { background: linear-gradient(135deg, #FF9800 0%, #FFC107 100%); }
        .needs-improvement { background: linear-gradient(135deg, #f44336 0%, #e57373 100%); }

        .validation-error {
            background: #ffebee;
            color: #c62828;
            padding: 18px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #f44336;
            font-weight: 500;
        }

        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #11853d;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .submission-status {
            background: #e8f5e8;
            color: #2e7d2e;
            padding: 18px;
            border-radius: 8px;
            margin-top: 20px;
            border-left: 4px solid #11853d;
        }

        .detailed-results {
            text-align: left;
            margin-top: 30px;
            padding: 25px;
            background: #f9f9f9;
            border-radius: 12px;
        }

        .result-question {
            margin-bottom: 25px;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #ddd;
        }

        .result-question.correct {
            background: #e8f5e8;
            border-left-color: #11853d;
        }

        .result-question.incorrect {
            background: #ffebee;
            border-left-color: #f44336;
        }

        .result-question h4 {
            margin-bottom: 12px;
            color: #333;
            font-weight: 600;
        }

        .result-details {
            font-size: 14px;
            margin-top: 10px;
        }

        .your-answer {
            color: #f44336;
            font-weight: bold;
        }

        .correct-answer {
            color: #11853d;
            font-weight: bold;
        }

        .explanation {
            background: #f0f0f0;
            padding: 12px;
            border-radius: 6px;
            margin-top: 10px;
            font-style: italic;
            line-height: 1.5;
        }

        .hidden {
            display: none;
        }

        .footer-logos {
            text-align: center;
            margin-top: 50px;
            padding-top: 30px;
            border-top: 1px solid #eee;
        }

        .footer-logos p {
            color: #666;
            font-size: 14px;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .card {
                padding: 25px;
            }
            
            .timer {
                float: none;
                display: block;
                text-align: center;
                margin-bottom: 20px;
            }
            
            .question-grid {
                justify-content: center;
            }

            .ipa-logo {
                max-width: 180px;
            }

            .header h1 {
                font-size: 2.2em;
            }

            .organization-info {
                padding: 20px;
            }

            .quiz-info {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Start Screen -->
        <div id="startScreen" class="card">
            <div class="header">
            <!-- Logo Section -->
<!-- Logo Section -->
<div class="logo-section">
    <!-- IPA Logo -->
   <img src="images/ipalogo.png" 
     alt="IPA - Innovations for Poverty Action" 
     class="ipa-logo">

</div>



                <h1>Technical Assessment</h1>
                <p class="subtitle">Innovations for Poverty Action</p>
            </div>

            <!-- Organization Information -->
            <div class="organization-info">
                <h4>Assessment Overview</h4>
                <p>This technical assessment evaluates expertise in data analysis, monitoring & evaluation, impact evaluation methodology, and programming logic for evidence-based research and policy implementation.</p>
            </div>

            <div class="quiz-info">
                <h3>Assessment Information:</h3>
                <ul>
                    <li>20 Multiple Choice Questions</li>
                    <li>35 Minutes Time Limit</li>
                    <li>40% Data Analysis, 25% M&E/Impact Evaluation, 35% Programming Logic</li>
                    <li>Tests expertise in research methodology and implementation</li>
                    <li>Covers statistical analysis, evaluation design, and technical problem-solving</li>
                    <li>All questions are required</li>
                    <li>Detailed results with explanations provided at the end</li>
                    <li>You can move between questions before submitting</li>
                </ul>
            </div>

            <div class="form-group">
                <label for="participantName">Your Full Name:</label>
                <input type="text" id="participantName" placeholder="Enter your full name" maxlength="50">
            </div>

            <div style="text-align: center;">
                <button class="btn btn-primary" onclick="startQuiz()" id="startBtn">
                    Start Assessment
                </button>
            </div>
        </div>

        <!-- Quiz Screen -->
        <div id="quizScreen" class="hidden">
            <!-- Header -->
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <div>
                        <h2 id="questionTitle">Question 1 of 20</h2>
                        <div class="question-info" id="questionInfo">Loading...</div>
                    </div>
                    <div class="timer" id="timer">35:00</div>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 5%;"></div>
                </div>
            </div>

            <!-- Question -->
            <div class="card">
                <div id="validationError" class="validation-error hidden">
                    ‚ö†Ô∏è Please select an answer before proceeding to the next question.
                </div>

                <div class="question" id="questionText">
                    Loading question...
                </div>

                <ul class="options" id="optionsList">
                    <!-- Options will be populated by JavaScript -->
                </ul>

                <div class="navigation">
                    <button class="btn btn-secondary" onclick="prevQuestion()" id="prevBtn" disabled>
                        Previous
                    </button>
                    
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-primary" onclick="nextQuestion()" id="nextBtn">
                            Next
                        </button>
                        <button class="btn btn-danger hidden" onclick="submitQuiz()" id="submitBtn">
                            Submit Assessment
                        </button>
                    </div>
                </div>

                <!-- Question Navigation Grid -->
                <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #ddd;">
                    <p style="margin-bottom: 15px; color: #666;">Question Status:</p>
                    <div class="question-grid" id="questionGrid">
                        <!-- Question numbers will be populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Completion Screen -->
        <div id="completionScreen" class="hidden">
            <div class="card completion-card">
                <div class="completion-icon" id="completionIcon">üéâ</div>
                <h2>Assessment Completed!</h2>
                <p id="thankYouMessage">Thank you for completing the technical assessment!</p>

                <div class="score-display">
                    <div class="score-number" id="finalScore">20/20</div>
                    <div style="font-size: 1.5em; margin: 10px 0;" id="finalPercentage">100%</div>
                    <div class="grade-badge excellent" id="gradeBadge">Excellent</div>
                </div>

                <div id="submissionStatus" class="submission-status hidden">
                    <div class="loading-spinner" id="loadingSpinner"></div>
                    <p id="statusMessage">Submitting your results...</p>
                </div>

                <!-- Detailed Results Section -->
                <div id="detailedResultsContainer" class="detailed-results">
                    <h3 style="margin-bottom: 20px; text-align: center;">Detailed Results</h3>
                    <div id="detailedResultsList">
                        <!-- Will be populated by JavaScript -->
                    </div>
                </div>

                <p style="margin-top: 30px; color: #666; font-size: 14px;">
                    Your results have been saved to the database for analysis and reporting purposes.
                </p>

                <div style="margin-top: 30px;">
                    <button class="btn btn-primary" onclick="resetQuiz()" id="resetBtn">
                        Take Assessment Again
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Technical assessment questions
      // Consumer Protection Technical Assessment Questions
const questions = [
    // Data Analysis Questions (8) - Including Excel/Pivot Table skills
    {
        id: 1,
        category: 'Data Analysis',
        skill: 'Understanding Correlation vs Causation',
        question: 'Your analysis shows states with more telecom tower installations have higher consumer satisfaction rates. Lagos has 8,500 towers and 82% satisfaction, while Kebbi has 150 towers and 31% satisfaction. Before recommending more towers for Kebbi, what should you examine first?',
        options: [
            'The cost of installing towers in each state',
            'Whether states with more towers also have better electricity, higher incomes, and urban infrastructure that affect service quality',
            'The population density of each state',
            'How many service providers operate in each state'
        ],
        correct: 'B',
        explanation: 'States with better infrastructure attract more tower investments AND naturally have better service quality for multiple reasons. You must control for these confounding factors or your tower recommendation might fail due to missing infrastructure prerequisites.'
    },
    {
        id: 2,
        category: 'Data Analysis',
        skill: 'Excel Pivot Table Analysis',
        question: 'You have 50,000 consumer complaint records in Excel. You need to find which service type has the highest complaint resolution rate by region. Which Excel feature and approach is most efficient?',
        options: [
            'Use COUNTIF formulas to count resolved complaints manually',
            'Create a Pivot Table with Service Type in Rows, Region in Columns, and Resolution Rate as Values',
            'Sort the data by complaint type and manually calculate percentages',
            'Use basic filters to examine each region separately'
        ],
        correct: 'B',
        explanation: 'Pivot Tables are designed exactly for this multi-dimensional analysis. They automatically calculate resolution rates across service types and regions, handle large datasets efficiently, and provide dynamic analysis capabilities that manual formulas cannot match.'
    },
    {
        id: 3,
        category: 'Data Analysis',
        skill: 'Statistical vs Practical Significance',
        question: 'A consumer education campaign improved complaint resolution knowledge from 62% to 64% in a survey of 45,000 consumers. The result is statistically significant (p<0.001). What is the most accurate interpretation?',
        options: [
            'The campaign had a meaningful impact since it\'s statistically significant',
            'The 2% improvement is small and may not justify the campaign cost despite statistical significance',
            'Large sample sizes can make tiny effects statistically significant',
            'Both B and C are correct'
        ],
        correct: 'D',
        explanation: 'With 45,000 respondents, even a 2% change achieves statistical significance. However, statistical significance doesn\'t equal practical importance. You need cost-benefit analysis to determine if a 2% knowledge improvement justifies the campaign investment.'
    },
    {
        id: 4,
        category: 'Data Analysis',
        skill: 'Self-Selection Bias Recognition',
        question: 'Your data shows consumers who use online complaint portals get 45% faster resolution times than those who call customer service. Before concluding that online portals are more efficient, what should you consider?',
        options: [
            'The technical requirements for using online portals',
            'Consumers who use online portals may be more tech-savvy and provide better-documented complaints',
            'The cost difference between online and phone support',
            'Whether all service providers offer online portals'
        ],
        correct: 'B',
        explanation: 'Self-selection bias: consumers who choose online portals likely provide more detailed, well-documented complaints and may be more persistent in follow-up. Their faster resolution might reflect their complaint quality, not portal efficiency.'
    },
    {
        id: 5,
        category: 'Data Analysis',
        skill: 'Excel Data Analysis - Simpson\'s Paradox',
        question: 'Your Excel analysis shows Provider A resolves 75% of complaints vs Provider B at 78%. But examining by complaint type: billing issues (A: 85%, B: 82%) and service issues (A: 90%, B: 88%). Provider A performs better in both categories but worse overall. How do you explain this in your report?',
        options: [
            'There are calculation errors in the Excel spreadsheet',
            'Provider A handles mostly billing complaints while Provider B handles more service complaints, and billing complaints are harder to resolve',
            'Provider A handles mostly service complaints while Provider B handles more billing complaints, and billing complaints are harder to resolve',
            'Providers discriminate based on complaint type'
        ],
        correct: 'B',
        explanation: 'This is Simpson\'s Paradox. Provider A excels in each complaint category but handles a higher proportion of difficult billing complaints, making their overall rate appear lower. Proper analysis requires examining both category-specific and overall performance.'
    },
    {
        id: 6,
        category: 'Data Analysis',
        skill: 'Measurement Error Impact',
        question: 'You\'re analyzing the relationship between household income and telecom service spending from consumer surveys. Many respondents understate their income to avoid appearing wealthy. How does this affect your analysis?',
        options: [
            'No effect since everyone understates income equally',
            'Makes the income-spending relationship appear weaker than it actually is',
            'Makes the relationship appear stronger than reality',
            'Only affects the average income calculation'
        ],
        correct: 'B',
        explanation: 'When income is measured with systematic error (underreporting), its correlation with spending appears weaker than the true relationship. This could lead to underestimating price sensitivity in your consumer protection policies.'
    },
    {
        id: 7,
        category: 'Data Analysis',
        skill: 'Base Rate Understanding',
        question: 'Your fraud detection algorithm correctly identifies 92% of fraudulent telecom accounts and has 6% false alarms. In a market where only 0.3% of accounts are fraudulent, what percentage of flagged accounts are actually fraudulent?',
        options: [
            '92% (the algorithm\'s accuracy rate)',
            'About 4% (most flagged accounts are actually legitimate)',
            'About 86% (92% minus 6%)',
            '99.7% (since fraud is very rare)'
        ],
        correct: 'B',
        explanation: 'With 0.3% fraud rate: in 100,000 accounts, 300 are fraudulent (276 detected) and 99,700 are legitimate (5,982 false alarms). Total flagged: 6,258. True fraud: 276. So 276/6,258 = 4.4% of flagged accounts are actually fraudulent.'
    },
    {
        id: 8,
        category: 'Data Analysis',
        skill: 'Regression to the Mean',
        question: 'After implementing a consumer protection intervention, you notice the worst-performing service providers improved significantly while top performers showed little change. Should the regulator focus all future interventions on poor performers?',
        options: [
            'Yes, poor performers clearly benefit more from intervention',
            'Need to be cautious - extreme performers naturally tend toward average performance over time, regardless of intervention',
            'No, good performers should get priority to maintain standards',
            'The intervention only works for poor performers'
        ],
        correct: 'B',
        explanation: 'Regression to the mean: extremely poor or good performers tend to move toward average performance on re-measurement due to natural variation. Need a proper control group to separate intervention effects from natural performance changes.'
    },

    // M&E Questions (5)
    {
        id: 9,
        category: 'M&E',
        skill: 'Pre-test and Post-test Purpose',
        question: 'Why is it important to conduct pre-tests and post-tests when evaluating consumer education programs?',
        options: [
            'To measure changes in consumer knowledge and behavior attributable to the program',
            'To check whether consumers understood the educational materials',
            'To evaluate how well trainers delivered the content',
            'To compare different groups of consumers'
        ],
        correct: 'A',
        explanation: 'Pre- and post-tests establish baseline knowledge and measure learning gains, allowing you to isolate the program\'s impact from existing consumer knowledge and external factors.'
    },
    {
        id: 10,
        category: 'M&E',
        skill: 'Output vs Outcome vs Impact',
        question: 'You evaluate a consumer awareness campaign about telecom billing rights. After 6 months: 85% can identify billing errors correctly, 68% now dispute incorrect charges, and overall billing complaints decreased 15%. How do you classify these results?',
        options: [
            'All three demonstrate program impact',
            'Knowledge is outcome, disputing is output, complaint reduction is impact',
            'Knowledge is output, disputing is outcome, complaint reduction is impact',
            'Only complaint reduction matters for program evaluation'
        ],
        correct: 'C',
        explanation: 'In M&E logic: outputs are immediate deliverables (knowledge gained), outcomes are behavior changes (disputing charges), impacts are system-level effects (reduced complaints). Each requires different measurement approaches and timing.'
    },
    {
        id: 11,
        category: 'M&E',
        skill: 'Complex Outcome Measurement',
        question: 'You need to measure whether consumer protection efforts have improved "consumer empowerment" in the telecom sector. Which indicator set best captures this complex outcome?',
        options: [
            'Only measure number of complaints filed',
            'Only measure consumer satisfaction survey scores',
            'Combine: consumers\' knowledge of rights + willingness to switch providers + ability to resolve disputes + usage of protection mechanisms',
            'Survey consumers about whether they feel empowered'
        ],
        correct: 'C',
        explanation: 'Complex outcomes like "empowerment" require multiple indicators capturing different dimensions. Single measures miss the full picture. Good M&E combines knowledge, behavior, capacity, and utilization indicators.'
    },
    {
        id: 12,
        category: 'M&E',
        skill: 'Monitoring vs Evaluation Distinction',
        question: 'What is the fundamental difference between monitoring and evaluation in consumer protection programs?',
        options: [
            'Monitoring tracks program activities and progress regularly; evaluation assesses overall effectiveness and impact',
            'Monitoring measures consumer satisfaction; evaluation measures knowledge gained',
            'Monitoring is done internally; evaluation is done by external parties',
            'Monitoring focuses on complaints; evaluation focuses on resolutions'
        ],
        correct: 'A',
        explanation: 'Monitoring is ongoing tracking of implementation progress and immediate outputs, while evaluation examines whether the program achieved its intended outcomes and impact on consumer protection.'
    },
    {
        id: 13,
        category: 'M&E',
        skill: 'Logical Framework Design',
        question: 'Your logical framework for improving telecom service quality has this impact: "Enhanced consumer satisfaction with telecom services." The outcome is "Service providers improve response times." What is the most appropriate output indicator?',
        options: [
            'Percentage of consumers satisfied with service nationwide',
            'Number of providers reporting improved customer satisfaction',
            'Number of service providers trained in customer service standards',
            'Average response time across all providers'
        ],
        correct: 'C',
        explanation: 'Logical framework hierarchy: outputs are direct program deliverables (providers trained), outcomes are behavior changes (improved response times), impacts are system-level changes (enhanced satisfaction). Training is the direct output that enables the outcome.'
    },

    // RCT/Impact Evaluation Questions (3)
    {
        id: 14,
        category: 'RCT/Impact',
        skill: 'Randomization Design Trade-offs',
        question: 'You want to test a new consumer complaint resolution process across 300 customer service centers in 50 cities. You could randomize individual centers or entire cities. What is the key trade-off?',
        options: [
            'Individual randomization gives better statistical power but centers might share practices with each other; city randomization prevents sharing but needs more cities for same power',
            'City randomization is always superior',
            'Individual randomization eliminates all contamination',
            'Both approaches yield identical results'
        ],
        correct: 'A',
        explanation: 'Individual randomization maximizes statistical power but creates spillover risk (treated centers sharing practices with controls). City randomization prevents contamination but reduces effective sample size, requiring larger studies for equivalent statistical power.'
    },
    {
        id: 15,
        category: 'RCT/Impact',
        skill: 'Intent-to-Treat Analysis',
        question: 'In a consumer education RCT, 78% of assigned participants attended training, while 22% of the control group received similar training elsewhere. For policy decisions, which analysis approach is most valuable?',
        options: [
            'Compare only those who actually received training vs those who didn\'t',
            'Compare based on original random assignment regardless of actual participation',
            'Exclude participants who didn\'t follow their assignment',
            'Weight results by actual participation rates'
        ],
        correct: 'B',
        explanation: 'Intent-to-treat analysis preserves randomization and answers the policy question: "What happens when we offer this program?" Real implementation will have non-compliance too. Comparing actual participants introduces selection bias.'
    },
    {
        id: 16,
        category: 'RCT/Impact',
        skill: 'Research vs Implementation Effects',
        question: 'A consumer protection helpline RCT showed 85% issue resolution with intensive monitoring and support. When scaled nationally with normal operations, resolution dropped to 45%. This difference most likely reflects:',
        options: [
            'The RCT design was flawed',
            'Research attention effects - intensive RCT monitoring created artificial conditions absent in normal implementation',
            'National rollout was poorly executed',
            'The helpline concept doesn\'t work'
        ],
        correct: 'B',
        explanation: 'Hawthorne effects occur when research attention changes behavior. RCTs with intensive monitoring and researcher support create ideal conditions. Effective evaluation tests interventions under realistic implementation conditions to predict real-world results.'
    },

    // Programming Logic Questions (4) - Including actual programming skills
    {
        id: 17,
        category: 'Programming Logic',
        skill: 'Conditional Logic Programming',
        question: 'You\'re writing code to categorize consumer complaints by urgency. Complete this logic: if complaint_type == "billing" and amount > 10000: priority = "high" elif complaint_type == "service" and downtime > 24: priority = "high" else: priority = "normal". A service complaint with 30 hours downtime gets what priority?',
        options: [
            'normal (because it\'s not a billing complaint)',
            'high (because downtime > 24 and complaint_type == "service")',
            'The code will produce an error',
            'It depends on the amount value'
        ],
        correct: 'B',
        explanation: 'The elif condition checks if complaint_type == "service" AND downtime > 24. Since both conditions are true (service complaint with 30 > 24 hours), priority is set to "high". Understanding conditional logic is essential for automated complaint processing systems.'
    },
    {
        id: 18,
        category: 'Programming Logic',
        skill: 'Boolean Logic and Operators',
        question: 'In a consumer protection database, you need to flag accounts where: (account_age < 6 months) AND (complaints != 0) AND NOT (resolved_complaints >= total_complaints). For an account with age=3, complaints=5, resolved=5, total=5, what does this expression evaluate to?',
        options: [
            'True (account gets flagged)',
            'False (account doesn\'t get flagged)',
            'Error (invalid comparison)',
            'Cannot determine without more information'
        ],
        correct: 'B',
        explanation: 'Breaking it down: (3 < 6) = True, (5 != 0) = True, (5 >= 5) = True so NOT(True) = False. The full expression: True AND True AND False = False. The account doesn\'t get flagged because all complaints are resolved.'
    },
    {
        id: 19,
        category: 'Programming Logic',
        skill: 'System Reliability Design',
        question: 'A consumer complaint processing system must handle 15,000 daily complaints from multiple channels. Some data feeds fail or arrive late. Which approach ensures reliable daily reporting?',
        options: [
            'Wait for all channels before processing any complaints',
            'Process each channel independently with retry capability for failed channels without reprocessing successful ones',
            'Process channels sequentially - if any fails, restart from beginning',
            'Process complaints as received and manually handle missing data'
        ],
        correct: 'B',
        explanation: 'Reliable systems use modular processing with checkpointing. This allows retry of specific failures without losing successful work, ensuring timely reports even when some data sources have issues. Critical for regulatory compliance that cannot wait for perfect data.'
    },
    {
        id: 20,
        category: 'Programming Logic',
        skill: 'Algorithm Optimization',
        question: 'A consumer complaint search system queries 8 million complaint records by phone number, taking 55 seconds per search. You could: add more servers, create a phone number index, cache frequent searches, or upgrade hardware. What provides the biggest performance improvement?',
        options: [
            'More servers to distribute query load',
            'Phone number index to enable instant lookups',
            'Caching to store recent search results',
            'Hardware upgrade for faster processing'
        ],
        correct: 'B',
        explanation: 'Algorithmic improvements beat hardware solutions. Searching 8M records linearly is inefficient compared to indexed search. A properly designed index provides 1000x+ improvement (from 55 seconds to milliseconds), while hardware might give 2-5x improvement. Smart algorithms beat expensive hardware.'
    }
];







        let currentQuestionIndex = 0;
        let answers = {};
        let participantName = '';
        let timeLeft = 2100; // 35 minutes in seconds
        let timerInterval;
        let quizStartTime;

        // Initialize the quiz
        function startQuiz() {
            const nameInput = document.getElementById('participantName');
            participantName = nameInput.value.trim();
            
            if (!participantName) {
                alert('Please enter your name before starting the assessment.');
                return;
            }

            if (participantName.length < 2) {
                alert('Please enter your full name (at least 2 characters).');
                return;
            }

            // Record start time
            quizStartTime = new Date();

            // Hide start screen, show quiz screen
            document.getElementById('startScreen').classList.add('hidden');
            document.getElementById('quizScreen').classList.remove('hidden');

            // Initialize quiz
            answers = {};
            currentQuestionIndex = 0;
            
            // Start timer
            startTimer();
            
            // Load first question
            loadQuestion();
            
            // Create question navigation grid
            createQuestionGrid();
        }

        function startTimer() {
            timerInterval = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    submitQuiz();
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            const timerElement = document.getElementById('timer');
            timerElement.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            
            // Change color when time is running out
            if (timeLeft <= 300) { // 5 minutes
                timerElement.style.background = '#ff4444';
            } else if (timeLeft <= 600) { // 10 minutes
                timerElement.style.background = '#ff8800';
            }
        }

        function loadQuestion() {
            const question = questions[currentQuestionIndex];
            
            // Update question title and info
            document.getElementById('questionTitle').textContent = `Question ${currentQuestionIndex + 1} of ${questions.length}`;
            document.getElementById('questionInfo').textContent = `${question.category}`;
            
            // Update question text
            document.getElementById('questionText').textContent = question.question;
            
            // Update progress bar
            const progress = ((currentQuestionIndex + 1) / questions.length) * 100;
            document.getElementById('progressFill').style.width = `${progress}%`;
            
            // Create options
            const optionsList = document.getElementById('optionsList');
            optionsList.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const optionLetter = String.fromCharCode(65 + index); // A, B, C, D
                const li = document.createElement('li');
                li.className = 'option';
                
                const isSelected = answers[question.id] === optionLetter;
                if (isSelected) {
                    li.classList.add('selected');
                }
                
                li.innerHTML = `
                    <input type="radio" name="question${question.id}" value="${optionLetter}" ${isSelected ? 'checked' : ''}>
                    <span style="font-weight: bold; margin-right: 10px;">${optionLetter}.</span>
                    ${option}
                `;
                
                li.addEventListener('click', () => selectOption(question.id, optionLetter));
                optionsList.appendChild(li);
            });
            
            // Update navigation buttons
            updateNavigationButtons();
            updateQuestionGrid();
            
            // Hide validation error
            document.getElementById('validationError').classList.add('hidden');
        }

        function selectOption(questionId, optionLetter) {
            answers[questionId] = optionLetter;
            
            // Update visual selection
            const optionsList = document.getElementById('optionsList');
            const options = optionsList.querySelectorAll('.option');
            options.forEach(option => option.classList.remove('selected'));
            
            const selectedOption = [...options].find(opt => 
                opt.querySelector('input').value === optionLetter
            );
            if (selectedOption) {
                selectedOption.classList.add('selected');
                selectedOption.querySelector('input').checked = true;
            }
            
            updateQuestionGrid();
            
            // Hide validation error if it was showing
            document.getElementById('validationError').classList.add('hidden');
        }

        function nextQuestion() {
            const currentQuestion = questions[currentQuestionIndex];
            
            // Check if current question is answered (mandatory)
            if (!answers[currentQuestion.id]) {
                document.getElementById('validationError').classList.remove('hidden');
                return;
            }
            
            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                loadQuestion();
            }
        }

        function prevQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                loadQuestion();
            }
        }

        function goToQuestion(index) {
            currentQuestionIndex = index;
            loadQuestion();
        }

        function updateNavigationButtons() {
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const submitBtn = document.getElementById('submitBtn');
            
            prevBtn.disabled = currentQuestionIndex === 0;
            
            if (currentQuestionIndex === questions.length - 1) {
                nextBtn.classList.add('hidden');
                submitBtn.classList.remove('hidden');
            } else {
                nextBtn.classList.remove('hidden');
                submitBtn.classList.add('hidden');
            }
        }

        function createQuestionGrid() {
            const grid = document.getElementById('questionGrid');
            grid.innerHTML = '';
            
            for (let i = 0; i < questions.length; i++) {
                const questionNum = document.createElement('div');
                questionNum.className = 'question-number';
                questionNum.textContent = i + 1;
                questionNum.onclick = () => goToQuestion(i);
                grid.appendChild(questionNum);
            }
            
            updateQuestionGrid();
        }

        function updateQuestionGrid() {
            const questionNumbers = document.querySelectorAll('.question-number');
            questionNumbers.forEach((num, index) => {
                num.className = 'question-number';
                
                if (index === currentQuestionIndex) {
                    num.classList.add('current');
                } else if (answers[questions[index].id]) {
                    num.classList.add('answered');
                }
            });
        }

        function createDetailedResults(score, total) {
            const container = document.getElementById('detailedResultsList');
            container.innerHTML = '';

            let correctCount = 0;
            let incorrectCount = 0;

            questions.forEach(question => {
                const userAnswer = answers[question.id];
                const isCorrect = userAnswer === question.correct;
                
                if (isCorrect) {
                    correctCount++;
                } else {
                    incorrectCount++;
                }

                const resultDiv = document.createElement('div');
                resultDiv.className = `result-question ${isCorrect ? 'correct' : 'incorrect'}`;
                
                const optionTexts = {};
                question.options.forEach((option, index) => {
                    optionTexts[String.fromCharCode(65 + index)] = option;
                });

                resultDiv.innerHTML = `
                    <h4>Question ${question.id}: ${question.category}</h4>
                    <p style="margin-bottom: 10px;">${question.question}</p>
                    <div class="result-details">
                        ${!isCorrect ? `<p><span class="your-answer">Your answer: ${userAnswer}.</span> ${optionTexts[userAnswer]}</p>` : ''}
                        <p><span class="correct-answer">Correct answer: ${question.correct}.</span> ${optionTexts[question.correct]}</p>
                        <div class="explanation">
                            <strong>Explanation:</strong> ${question.explanation}
                        </div>
                    </div>
                `;
                
                container.appendChild(resultDiv);
            });

            // Add summary at the top
            const summaryDiv = document.createElement('div');
            summaryDiv.style.cssText = 'margin-bottom: 20px; padding: 15px; background: #e3f2fd; border-radius: 6px; text-align: center;';
            summaryDiv.innerHTML = `
                <h4 style="color: #1976d2; margin-bottom: 10px;">Results Summary</h4>
                <p><strong>Correct:</strong> ${correctCount} questions | <strong>Incorrect:</strong> ${incorrectCount} questions</p>
                <p style="margin-top: 8px; font-size: 14px; color: #666;">
                    ${incorrectCount > 0 ? 'Review the incorrect answers below to learn more.' : 'Perfect score! Excellent work.'}
                </p>
            `;
            container.insertBefore(summaryDiv, container.firstChild);
        }

        async function submitQuiz() {
            // Check if all questions are answered
            const unansweredQuestions = [];
            questions.forEach(q => {
                if (!answers[q.id]) {
                    unansweredQuestions.push(q.id);
                }
            });
            
            if (unansweredQuestions.length > 0) {
                alert(`Please answer all questions before submitting. Missing: Question(s) ${unansweredQuestions.join(', ')}`);
                return;
            }
            
            // Calculate score and time taken
            let score = 0;
            questions.forEach(q => {
                if (answers[q.id] === q.correct) {
                    score++;
                }
            });

            const quizEndTime = new Date();
            const timeTakenSeconds = Math.floor((quizEndTime - quizStartTime) / 1000);
            
            // Stop timer
            clearInterval(timerInterval);
            
            // Show completion screen first
            showCompletionScreen(score, questions.length);
            
            // Create detailed results
            createDetailedResults(score, questions.length);
            
            // Prepare data for submission
            const quizResult = {
                participant_name: participantName,
                completed_at: quizEndTime.toISOString(),
                total_score: score,
                percentage: Math.round((score / questions.length) * 100),
                time_taken: timeTakenSeconds
            };
            
            // Add individual question responses
            questions.forEach(q => {
                quizResult[`Q${q.id}`] = answers[q.id] || '';
                quizResult[`Q${q.id}_correct`] = q.correct;
                quizResult[`Q${q.id}_skill`] = q.skill;
                quizResult[`Q${q.id}_category`] = q.category;
            });
            
            // Submit to backend
            await submitToDatabase(quizResult);
        }

        async function submitToDatabase(data) {
            const statusDiv = document.getElementById('submissionStatus');
            const statusMessage = document.getElementById('statusMessage');
            const loadingSpinner = document.getElementById('loadingSpinner');
            
            // Show submission status
            statusDiv.classList.remove('hidden');
            statusMessage.textContent = 'Submitting your results...';
            loadingSpinner.style.display = 'block';
            
            console.log('Attempting to submit assessment data:', data);
            
            try {
                const response = await fetch('/api/submit-quiz', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });
                
                console.log('Response received:', response.status, response.statusText);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('HTTP Error:', response.status, errorText);
                    throw new Error(`HTTP ${response.status}: ${errorText}`);
                }
                
                const result = await response.json();
                console.log('Success response:', result);
                
                if (result.success) {
                    // Success
                    loadingSpinner.style.display = 'none';
                    statusMessage.textContent = `Results successfully saved! (ID: ${result.id})`;
                    statusDiv.style.background = '#e8f5e8';
                    statusDiv.style.color = '#2e7d2e';
                    statusDiv.style.borderLeftColor = '#11853d';
                    
                    console.log('Assessment submitted successfully:', result);
                } else {
                    throw new Error(result.error || 'Submission failed');
                }
            } catch (error) {
                console.error('Error submitting assessment:', error);
                
                // Show error but don't prevent completion
                loadingSpinner.style.display = 'none';
                statusMessage.textContent = `Warning: Results may not have been saved. Error: ${error.message}. Please inform the administrator.`;
                statusDiv.style.background = '#fff3e0';
                statusDiv.style.color = '#e65100';
                statusDiv.style.borderLeftColor = '#ff9800';
            }
        }

        function showCompletionScreen(score, total) {
            const percentage = Math.round((score / total) * 100);
            
            // Hide quiz screen, show completion screen
            document.getElementById('quizScreen').classList.add('hidden');
            document.getElementById('completionScreen').classList.remove('hidden');
            
            // Update completion screen
            document.getElementById('finalScore').textContent = `${score}/${total}`;
            document.getElementById('finalPercentage').textContent = `${percentage}%`;
            document.getElementById('thankYouMessage').textContent = `Thank you, ${participantName}!`;
            
            // Set icon and grade
            const icon = document.getElementById('completionIcon');
            const badge = document.getElementById('gradeBadge');
            
            if (percentage >= 80) {
                icon.textContent = 'üéâ';
                badge.textContent = 'Excellent';
                badge.className = 'grade-badge excellent';
            } else if (percentage >= 60) {
                icon.textContent = 'üëç';
                badge.textContent = 'Good';
                badge.className = 'grade-badge good';
            } else {
                icon.textContent = 'üìö';
                badge.textContent = 'Needs Improvement';
                badge.className = 'grade-badge needs-improvement';
            }
        }

        function resetQuiz() {
            // Reset all variables
            currentQuestionIndex = 0;
            answers = {};
            participantName = '';
            timeLeft = 2100;
            quizStartTime = null;
            
            // Clear timer
            clearInterval(timerInterval);
            
            // Reset form
            document.getElementById('participantName').value = '';
            
            // Hide status message
            document.getElementById('submissionStatus').classList.add('hidden');
            
            // Show start screen
            document.getElementById('completionScreen').classList.add('hidden');
            document.getElementById('startScreen').classList.remove('hidden');
        }

        // Initialize when page loads
        window.addEventListener('load', () => {
            console.log('IPA Technical Assessment loaded successfully');
            console.log('Questions available:', questions.length);
            console.log('Focus areas: Data Analysis, M&E, RCT/Impact, Programming Logic');
        });

        // Prevent accidental page refresh during quiz
        window.addEventListener('beforeunload', function (e) {
            if (document.getElementById('quizScreen').classList.contains('hidden')) {
                return; // Quiz not in progress
            }
            
            const confirmationMessage = 'Are you sure you want to leave? Your assessment progress will be lost.';
            e.returnValue = confirmationMessage;
            return confirmationMessage;
        });

        // Handle page visibility change (tab switching, etc.)
        document.addEventListener('visibilitychange', function() {
            if (document.hidden && !document.getElementById('quizScreen').classList.contains('hidden')) {
                console.log('User switched tabs during assessment at:', new Date().toISOString());
                // You could implement additional security measures here
            }
        });
    </script>
</body>
</html>