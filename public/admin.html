<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consumer Protection Technical Assessment - Admin Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-green: #059669;
            --primary-green-light: #10b981;
            --primary-green-dark: #047857;
            --accent-green: #34d399;
            --surface: #ffffff;
            --surface-alt: #f8fafc;
            --surface-dark: #1e293b;
            --text-primary: #0f172a;
            --text-secondary: #64748b;
            --text-muted: #94a3b8;
            --border-light: #e2e8f0;
            --border-medium: #cbd5e1;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            line-height: 1.6;
            color: var(--text-primary);
            font-weight: 400;
        }

        /* Sidebar Navigation */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 320px;
            height: 100vh;
            background: linear-gradient(145deg, var(--surface-dark) 0%, #2d3748 50%, #1a202c 100%);
            color: white;
            padding: 0;
            overflow-y: auto;
            z-index: 1000;
            box-shadow: var(--shadow-xl);
            border-right: 1px solid rgba(255,255,255,0.1);
        }

        .sidebar::-webkit-scrollbar {
            width: 6px;
        }

        .sidebar::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.05);
        }

        .sidebar::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.2);
            border-radius: 3px;
        }

        .sidebar-header {
            padding: 32px 24px;
            background: linear-gradient(135deg, var(--primary-green) 0%, var(--primary-green-dark) 100%);
            position: relative;
            overflow: hidden;
        }

        .sidebar-header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: pulse 4s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1) rotate(0deg); opacity: 0.3; }
            50% { transform: scale(1.1) rotate(180deg); opacity: 0.1; }
        }

        .sidebar-header-content {
            position: relative;
            z-index: 2;
        }

        .sidebar-header h1 {
            font-size: 1.5rem;
            font-weight: 800;
            margin-bottom: 8px;
            letter-spacing: -0.025em;
        }

        .sidebar-header p {
            font-size: 0.875rem;
            opacity: 0.9;
            font-weight: 500;
        }

        .sidebar-content {
            padding: 24px;
        }

        .nav-section {
            margin-bottom: 32px;
        }

        .nav-section-title {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            font-weight: 600;
            color: rgba(255,255,255,0.6);
            margin-bottom: 16px;
            padding-left: 12px;
        }

        .nav-item {
            padding: 14px 16px;
            margin-bottom: 4px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 0.95rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            position: relative;
            overflow: hidden;
        }

        .nav-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .nav-item:hover::before {
            opacity: 1;
        }

        .nav-item:hover {
            transform: translateX(8px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .nav-item.active {
            background: linear-gradient(135deg, var(--primary-green) 0%, var(--primary-green-light) 100%);
            box-shadow: 0 4px 20px rgba(5, 150, 105, 0.4);
            transform: translateX(8px);
        }

        .nav-item.active::before {
            opacity: 0;
        }

        .nav-item i {
            margin-right: 12px;
            width: 20px;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .stats-mini {
            background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
            padding: 20px;
            border-radius: 16px;
            margin-top: 24px;
            border: 1px solid rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
        }

        .stats-mini h4 {
            font-size: 0.875rem;
            font-weight: 600;
            margin-bottom: 16px;
            color: rgba(255,255,255,0.9);
        }

        .stat-mini {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .stat-mini:last-child {
            margin-bottom: 0;
        }

        .stat-mini-value {
            font-weight: 700;
            color: var(--accent-green);
        }

        .logout-btn {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            color: white;
            border: none;
            padding: 14px 20px;
            border-radius: 12px;
            cursor: pointer;
            width: 100%;
            margin-top: 32px;
            font-weight: 600;
            font-size: 0.95rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(220, 38, 38, 0.3);
        }

        .logout-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(220, 38, 38, 0.4);
        }

        /* Main Content */
        .main-content {
            margin-left: 320px;
            padding: 32px;
            min-height: 100vh;
        }

        .content-section {
            display: none;
            animation: slideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .content-section.active {
            display: block;
        }

        @keyframes slideIn {
            from { 
                opacity: 0; 
                transform: translateY(24px);
            }
            to { 
                opacity: 1; 
                transform: translateY(0);
            }
        }

        .section-header {
            margin-bottom: 32px;
            position: relative;
        }

        .section-header::after {
            content: '';
            position: absolute;
            bottom: -16px;
            left: 0;
            width: 60px;
            height: 3px;
            background: linear-gradient(90deg, var(--primary-green) 0%, var(--accent-green) 100%);
            border-radius: 2px;
        }

        .section-title {
            font-size: 2.25rem;
            font-weight: 800;
            color: var(--text-primary);
            letter-spacing: -0.025em;
            margin-bottom: 8px;
        }

        .section-subtitle {
            color: var(--text-secondary);
            font-size: 1.1rem;
            font-weight: 500;
        }

        /* Enhanced Cards */
        .card {
            background: var(--surface);
            border-radius: 20px;
            padding: 32px;
            margin-bottom: 32px;
            border: 1px solid var(--border-light);
            box-shadow: var(--shadow-lg);
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-green) 0%, var(--accent-green) 50%, var(--primary-green-light) 100%);
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-xl);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--border-light);
        }

        .card-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .card-title i {
            color: var(--primary-green);
            font-size: 1.4rem;
        }

        /* Enhanced Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: var(--surface);
            padding: 32px 28px;
            border-radius: 20px;
            text-align: center;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border-light);
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: linear-gradient(90deg, var(--primary-green) 0%, var(--accent-green) 100%);
        }

        .stat-card::after {
            content: '';
            position: absolute;
            top: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, rgba(5, 150, 105, 0.1) 0%, rgba(52, 211, 153, 0.1) 100%);
        }

        .stat-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.12);
        }

        .stat-icon {
            position: absolute;
            top: 24px;
            right: 24px;
            font-size: 1.5rem;
            color: var(--primary-green);
            z-index: 2;
        }

        .stat-number {
            font-size: 3rem;
            font-weight: 800;
            color: var(--primary-green);
            margin-bottom: 8px;
            line-height: 1;
            position: relative;
            z-index: 2;
        }

        .stat-label {
            color: var(--text-secondary);
            font-weight: 600;
            font-size: 1rem;
            position: relative;
            z-index: 2;
        }

        /* Enhanced Buttons */
        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin: 6px;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-green) 0%, var(--primary-green-light) 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(5, 150, 105, 0.4);
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(5, 150, 105, 0.5);
        }

        .btn-secondary {
            background: linear-gradient(135deg, var(--text-secondary) 0%, var(--text-primary) 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(100, 116, 139, 0.4);
        }

        .btn-secondary:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(100, 116, 139, 0.5);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary-green);
            color: var(--primary-green);
        }

        .btn-outline:hover:not(:disabled) {
            background: var(--primary-green);
            color: white;
            transform: translateY(-3px);
        }

        .btn:disabled {
            background: var(--border-medium);
            color: var(--text-muted);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* Enhanced Question Analytics */
        .question-analytics {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 32px;
            margin-bottom: 40px;
        }

        .question-list {
            list-style: none;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .question-item {
            padding: 24px;
            background: var(--surface);
            border-radius: 16px;
            border: 1px solid var(--border-light);
            box-shadow: var(--shadow-md);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .question-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            width: 5px;
            background: var(--border-light);
            transition: background 0.3s ease;
        }

        .question-item.hardest::before {
            background: linear-gradient(180deg, #dc2626 0%, #b91c1c 100%);
        }

        .question-item.easiest::before {
            background: linear-gradient(180deg, var(--primary-green) 0%, var(--primary-green-light) 100%);
        }

        .question-item:hover {
            transform: translateX(8px);
            box-shadow: var(--shadow-lg);
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
            gap: 16px;
        }

        .question-number {
            font-weight: 700;
            color: var(--text-primary);
            font-size: 0.95rem;
        }

        .question-success-rate {
            font-weight: 800;
            font-size: 1.25rem;
            padding: 8px 16px;
            border-radius: 20px;
            min-width: 80px;
            text-align: center;
        }

        .question-success-rate.low { 
            color: white;
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
        }

        .question-success-rate.high { 
            color: white;
            background: linear-gradient(135deg, var(--primary-green) 0%, var(--primary-green-light) 100%);
        }

        .question-preview {
            font-size: 0.9rem;
            color: var(--text-secondary);
            line-height: 1.5;
            font-weight: 500;
        }

        /* Enhanced Participant Cards */
        .participant-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            flex-wrap: wrap;
            gap: 16px;
        }

        .sort-controls {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .participant-card {
            background: var(--surface);
            border: 1px solid var(--border-light);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 16px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .participant-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(5, 150, 105, 0.05), transparent);
            transition: left 0.5s;
        }

        .participant-card:hover::before {
            left: 100%;
        }

        .participant-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-xl);
            border-color: var(--primary-green);
        }

        .participant-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
            gap: 20px;
        }

        .participant-info {
            flex: 1;
        }

        .participant-name {
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--text-primary);
            margin-bottom: 6px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .participant-name i {
            color: var(--primary-green);
            font-size: 1rem;
        }

        .participant-date {
            font-size: 0.875rem;
            color: var(--text-muted);
            font-weight: 500;
        }

        .participant-score {
            text-align: right;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 12px;
        }

        .score-badge {
            padding: 10px 20px;
            border-radius: 25px;
            color: white;
            font-weight: 700;
            font-size: 1rem;
            box-shadow: var(--shadow-md);
            position: relative;
            overflow: hidden;
        }

        .score-badge::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .score-badge:hover::before {
            left: 100%;
        }

        .score-badge.excellent { 
            background: linear-gradient(135deg, var(--primary-green) 0%, var(--primary-green-light) 100%);
        }

        .score-badge.good { 
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        }

        .score-badge.needs-improvement { 
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
        }

        .expand-toggle {
            color: var(--text-muted);
            font-size: 0.875rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .participant-details {
            display: none;
            margin-top: 24px;
            padding-top: 24px;
            border-top: 2px solid var(--border-light);
        }

        .participant-details.expanded {
            display: block;
            animation: expandIn 0.3s ease;
        }

        @keyframes expandIn {
            from { opacity: 0; max-height: 0; }
            to { opacity: 1; max-height: 500px; }
        }

        .skill-breakdown {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
        }

        .skill-item {
            background: var(--surface-alt);
            padding: 20px;
            border-radius: 16px;
            text-align: center;
            border: 2px solid var(--border-light);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .skill-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--border-light);
            transition: background 0.3s ease;
        }

        .skill-item:hover {
            border-color: var(--primary-green);
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .skill-item:hover::before {
            background: linear-gradient(90deg, var(--primary-green) 0%, var(--accent-green) 100%);
        }

        .skill-percentage {
            font-size: 1.75rem;
            font-weight: 800;
            margin-bottom: 8px;
        }

        .skill-percentage.excellent { color: var(--primary-green); }
        .skill-percentage.good { color: #f59e0b; }
        .skill-percentage.needs-improvement { color: #dc2626; }

        .skill-name {
            font-size: 0.95rem;
            color: var(--text-primary);
            font-weight: 600;
            margin-bottom: 4px;
        }

        .skill-score {
            font-size: 0.8rem;
            color: var(--text-muted);
            font-weight: 500;
        }

        /* Enhanced Results Table */
        .table-container {
            overflow-x: auto;
            background: var(--surface);
            border-radius: 20px;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border-light);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-family: 'JetBrains Mono', monospace;
        }

        th, td {
            padding: 20px 16px;
            text-align: left;
            border-bottom: 1px solid var(--border-light);
        }

        th {
            background: linear-gradient(135deg, var(--surface-alt) 0%, #f1f5f9 100%);
            font-weight: 700;
            color: var(--text-primary);
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        tr:hover {
            background: var(--surface-alt);
        }

        td:first-child {
            font-weight: 700;
            color: var(--text-primary);
        }

        .grade-badge {
            padding: 6px 14px;
            border-radius: 16px;
            color: white;
            font-size: 0.8rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.025em;
        }

        /* Password Screen */
        .password-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(135deg, var(--surface-dark) 0%, #2d3748 50%, #1a202c 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .password-screen::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.03'%3E%3Ccircle cx='30' cy='30' r='2'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E") repeat;
        }

        .password-card {
            background: var(--surface);
            padding: 48px;
            border-radius: 24px;
            box-shadow: 0 25px 60px rgba(0,0,0,0.3);
            text-align: center;
            max-width: 450px;
            width: 90%;
            position: relative;
            z-index: 2;
        }

        .password-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: linear-gradient(90deg, var(--primary-green) 0%, var(--accent-green) 100%);
            border-radius: 24px 24px 0 0;
        }

        .password-card h1 {
            color: var(--text-primary);
            margin-bottom: 12px;
            font-size: 2.25rem;
            font-weight: 800;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }

        .password-card h1 i {
            color: var(--primary-green);
        }

        .password-card p {
            color: var(--text-secondary);
            margin-bottom: 32px;
            font-size: 1.1rem;
            font-weight: 500;
        }

        .password-input {
            display: flex;
            gap: 16px;
            margin-bottom: 24px;
        }

        .password-input input {
            flex: 1;
            padding: 16px 20px;
            border: 2px solid var(--border-light);
            border-radius: 12px;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s ease;
            background: var(--surface-alt);
        }

        .password-input input:focus {
            outline: none;
            border-color: var(--primary-green);
            box-shadow: 0 0 0 3px rgba(5, 150, 105, 0.1);
        }

        .password-hint {
            font-size: 0.9rem;
            color: var(--text-muted);
            background: var(--surface-alt);
            padding: 16px;
            border-radius: 12px;
            border: 1px solid var(--border-light);
            font-weight: 500;
        }

        .password-hint strong {
            color: var(--primary-green);
            font-family: 'JetBrains Mono', monospace;
        }

        /* Loading and Error States */
        .loading-state {
            text-align: center;
            padding: 80px;
            color: var(--text-secondary);
        }

        .loading-state i {
            font-size: 3rem;
            color: var(--primary-green);
            margin-bottom: 20px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .error-state, .success-state {
            padding: 24px;
            border-radius: 16px;
            margin: 20px 0;
            border: 1px solid;
            font-weight: 600;
        }

        .error-state {
            background: #fef2f2;
            color: #dc2626;
            border-color: #fecaca;
        }

        .success-state {
            background: #f0fdf4;
            color: var(--primary-green);
            border-color: #bbf7d0;
        }

        .hidden { display: none; }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .sidebar {
                width: 280px;
            }
            .main-content {
                margin-left: 280px;
            }
        }

        @media (max-width: 1024px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }

            .sidebar.active {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
                padding: 24px;
            }

            .question-analytics {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            }
        }

        @media (max-width: 768px) {
            .section-title {
                font-size: 1.875rem;
            }

            .participant-controls {
                flex-direction: column;
                align-items: stretch;
            }

            .skill-breakdown {
                grid-template-columns: 1fr;
            }

            .card {
                padding: 24px;
            }
        }
    </style>
</head>
<body>
    <!-- Password Screen -->
    <div id="passwordScreen" class="password-screen">
        <div class="password-card">
            <h1><i class="fas fa-shield-alt"></i> Admin Access</h1>
            <p>Please enter the admin password to access the dashboard.</p>
            
            <div class="password-input">
                <input type="password" id="adminPassword" placeholder="Enter admin password" maxlength="50">
                <button class="btn btn-primary" onclick="login()">
                    <i class="fas fa-sign-in-alt"></i> Login
                </button>
            </div>
            
            <div class="password-hint">
                Default password: <strong>admin123</strong>
            </div>
            
            <div id="loginError" class="error-state hidden"></div>
        </div>
    </div>

    <!-- Main Dashboard -->
    <div id="mainDashboard" class="hidden">
        <!-- Sidebar Navigation -->
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-header-content">
                    <h1><i class="fas fa-chart-line"></i> Consumer Protection Assessment</h1>
                    <p>Advanced Analytics Dashboard</p>
                </div>
            </div>

            <div class="sidebar-content">
                <div class="nav-section">
                    <div class="nav-section-title">Overview</div>
                    <div class="nav-item active" onclick="showSection('overview')">
                        <i class="fas fa-tachometer-alt"></i> Dashboard Home
                    </div>
                    <div class="nav-item" onclick="showSection('analytics')">
                        <i class="fas fa-chart-bar"></i> Question Analytics
                    </div>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">Data Management</div>
                    <div class="nav-item" onclick="showSection('participants')">
                        <i class="fas fa-users"></i> Participants
                    </div>
                    <div class="nav-item" onclick="showSection('results')">
                        <i class="fas fa-table"></i> Results Table
                    </div>
                    <div class="nav-item" onclick="showSection('actions')">
                        <i class="fas fa-cogs"></i> Actions & Export
                    </div>
                </div>

                <div class="stats-mini">
                    <h4><i class="fas fa-info-circle"></i> Quick Stats</h4>
                    <div class="stat-mini">
                        <span>Total Participants:</span>
                        <span class="stat-mini-value" id="sidebarTotal">-</span>
                    </div>
                    <div class="stat-mini">
                        <span>Average Score:</span>
                        <span class="stat-mini-value" id="sidebarAverage">-</span>
                    </div>
                    <div class="stat-mini">
                        <span>Today:</span>
                        <span class="stat-mini-value" id="sidebarToday">-</span>
                    </div>
                </div>

                <button class="logout-btn" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Loading State -->
            <div id="loadingState" class="loading-state hidden">
                <i class="fas fa-spinner"></i>
                <h3>Loading dashboard data...</h3>
            </div>

            <!-- Error State -->
            <div id="errorState" class="error-state hidden">
                <i class="fas fa-exclamation-triangle"></i>
                <strong>Connection Error</strong>
                <p id="errorMessage">Unable to load data from the server.</p>
            </div>

            <!-- Overview Section -->
            <div id="overviewSection" class="content-section active">
                <div class="section-header">
                    <h2 class="section-title">Dashboard Overview</h2>
                    <p class="section-subtitle">Consumer Protection Technical Assessment Performance Summary</p>
                </div>

                <!-- Statistics Grid -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <i class="fas fa-users stat-icon"></i>
                        <div class="stat-number" id="totalParticipants">-</div>
                        <div class="stat-label">Total Participants</div>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-percentage stat-icon"></i>
                        <div class="stat-number" id="averageScore">-</div>
                        <div class="stat-label">Average Score</div>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-calendar-day stat-icon"></i>
                        <div class="stat-number" id="todayCount">-</div>
                        <div class="stat-label">Completed Today</div>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-trophy stat-icon"></i>
                        <div class="stat-number" id="excellentCount">-</div>
                        <div class="stat-label">Excellent Scores (80%+)</div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-bolt"></i> Quick Actions
                        </h3>
                        <button class="btn btn-outline" onclick="refreshData()">
                            <i class="fas fa-sync-alt"></i> Refresh Data
                        </button>
                    </div>
                    <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                        <button class="btn btn-primary" onclick="downloadCSV()" id="downloadBtn" disabled>
                            <i class="fas fa-download"></i> Download CSV
                        </button>
                        <button class="btn btn-secondary" onclick="checkHealth()">
                            <i class="fas fa-heartbeat"></i> Health Check
                        </button>
                        <button class="btn btn-outline" onclick="showSection('analytics')">
                            <i class="fas fa-chart-line"></i> View Analytics
                        </button>
                    </div>
                    <div id="actionMessage" class="hidden"></div>
                </div>

                <!-- Empty State -->
                <div id="emptyState" class="card hidden" style="text-align: center; padding: 80px;">
                    <i class="fas fa-clipboard-list" style="font-size: 4rem; color: var(--text-muted); margin-bottom: 24px;"></i>
                    <h3>No Results Yet</h3>
                    <p style="margin: 20px 0; color: var(--text-secondary);">Results will appear here once participants complete the assessment.</p>
                    <a href="/" target="_blank" class="btn btn-primary">
                        <i class="fas fa-external-link-alt"></i> Open Assessment Page
                    </a>
                </div>
            </div>

            <!-- Question Analytics Section -->
            <div id="analyticsSection" class="content-section">
                <div class="section-header">
                    <h2 class="section-title">Question Analytics</h2>
                    <p class="section-subtitle">Performance insights by question and skill area</p>
                </div>

                <div class="question-analytics">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-exclamation-triangle"></i> Most Challenging Questions
                            </h3>
                        </div>
                        <ul class="question-list" id="hardestQuestions">
                            <!-- Populated by JavaScript -->
                        </ul>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-check-circle"></i> Best Performing Questions
                            </h3>
                        </div>
                        <ul class="question-list" id="easiestQuestions">
                            <!-- Populated by JavaScript -->
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-brain"></i> Skill Areas Performance
                        </h3>
                    </div>
                    <div id="skillAreasChart">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Participants Section -->
            <div id="participantsSection" class="content-section">
                <div class="section-header">
                    <h2 class="section-title">Individual Analysis</h2>
                    <p class="section-subtitle">Detailed participant performance breakdown</p>
                </div>

                <div class="card">
                    <div class="participant-controls">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-info-circle" style="color: var(--primary-green);"></i>
                            <span style="color: var(--text-secondary); font-weight: 500;">Click on any participant to view detailed breakdown</span>
                        </div>
                        <div class="sort-controls">
                            <button class="btn btn-outline" onclick="sortParticipants('highest')">
                                <i class="fas fa-sort-amount-down"></i> Highest Scores
                            </button>
                            <button class="btn btn-outline" onclick="sortParticipants('lowest')">
                                <i class="fas fa-sort-amount-up"></i> Lowest Scores
                            </button>
                            <button class="btn btn-outline" onclick="sortParticipants('recent')">
                                <i class="fas fa-clock"></i> Most Recent
                            </button>
                        </div>
                    </div>
                    <div id="participantAnalysis">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Results Table Section -->
            <div id="resultsSection" class="content-section">
                <div class="section-header">
                    <h2 class="section-title">Results Table</h2>
                    <p class="section-subtitle">Complete results overview</p>
                </div>

                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th><i class="fas fa-user"></i> Participant</th>
                                <th><i class="fas fa-hashtag"></i> Score</th>
                                <th><i class="fas fa-percentage"></i> Percentage</th>
                                <th><i class="fas fa-chart-bar"></i> Data Analysis</th>
                                <th><i class="fas fa-tasks"></i> M&E</th>
                                <th><i class="fas fa-flask"></i> RCT/Impact</th>
                                <th><i class="fas fa-code"></i> Programming</th>
                                <th><i class="fas fa-medal"></i> Grade</th>
                                <th><i class="fas fa-clock"></i> Completed</th>
                            </tr>
                        </thead>
                        <tbody id="resultsTableBody">
                            <!-- Populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Actions Section -->
            <div id="actionsSection" class="content-section">
                <div class="section-header">
                    <h2 class="section-title">Data Management</h2>
                    <p class="section-subtitle">Export data and system maintenance</p>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-download"></i> Export & Download
                        </h3>
                    </div>
                    <p style="color: var(--text-secondary); margin-bottom: 24px; font-weight: 500;">Download comprehensive reports and data exports for analysis and reporting purposes.</p>
                    <div style="display: flex; gap: 16px; flex-wrap: wrap;">
                        <button class="btn btn-primary" onclick="downloadCSV()" id="downloadBtn2" disabled>
                            <i class="fas fa-file-csv"></i> Download Enhanced CSV
                        </button>
                        <button class="btn btn-secondary" onclick="checkHealth()">
                            <i class="fas fa-stethoscope"></i> System Health Check
                        </button>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-exclamation-triangle"></i> Data Management
                        </h3>
                    </div>
                    <p style="color: #dc2626; margin-bottom: 24px; font-weight: 600;">
                        <i class="fas fa-warning"></i> Danger Zone: These actions cannot be undone.
                    </p>
                    <button class="btn" onclick="clearAllData()" style="background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%); color: white;">
                        <i class="fas fa-trash-alt"></i> Clear All Data
                    </button>
                </div>

                <div id="actionMessage2" class="hidden"></div>
            </div>
        </div>
    </div>

    <script>
        const ADMIN_PASSWORD = 'admin123';
        let quizResults = [];
        let analyticsData = null;
        let currentSort = 'recent';

        // Authentication
        function login() {
            const password = document.getElementById('adminPassword').value;
            if (password === ADMIN_PASSWORD) {
                document.getElementById('passwordScreen').classList.add('hidden');
                document.getElementById('mainDashboard').classList.remove('hidden');
                loadDashboard();
            } else {
                showLoginError('Incorrect password. Please try again.');
                document.getElementById('adminPassword').value = '';
            }
        }

        function logout() {
            document.getElementById('mainDashboard').classList.add('hidden');
            document.getElementById('passwordScreen').classList.remove('hidden');
            document.getElementById('adminPassword').value = '';
        }

        function showLoginError(message) {
            const errorDiv = document.getElementById('loginError');
            errorDiv.textContent = message;
            errorDiv.classList.remove('hidden');
            setTimeout(() => errorDiv.classList.add('hidden'), 3000);
        }

        // Navigation
        function showSection(sectionName) {
            // Remove active class from all nav items and sections
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            document.querySelectorAll('.content-section').forEach(section => section.classList.remove('active'));

            // Add active class to clicked nav item
            event.target.classList.add('active');

            // Show the selected section
            document.getElementById(sectionName + 'Section').classList.add('active');
        }

        // Dashboard Management
        async function loadDashboard() {
            await refreshData();
            setInterval(refreshData, 60000);
        }

        async function refreshData() {
            try {
                showLoading();
                
                const statsResponse = await fetch('/api/stats');
                if (statsResponse.ok) {
                    const stats = await statsResponse.json();
                    updateStatistics(stats);
                }
                
                const resultsResponse = await fetch('/api/results');
                if (resultsResponse.ok) {
                    const results = await resultsResponse.json();
                    quizResults = results;
                    updateResultsTable(results);
                    
                    if (results.length > 0) {
                        generateAnalytics(results);
                    }
                } else {
                    throw new Error('Failed to fetch results');
                }
                
                toggleSections();
                hideError();
                
            } catch (error) {
                console.error('Error refreshing data:', error);
                showError('Failed to load data: ' + error.message);
            } finally {
                hideLoading();
            }
        }

        function generateAnalytics(results) {
            const questions = [
                // Data Analysis Questions (8) - Including Excel/Pivot Table skills
                { id: 1, category: 'Data Analysis', skill: 'Understanding Correlation vs Causation', question: 'Your analysis shows states with more telecom tower installations have higher consumer satisfaction rates. Lagos has 8,500 towers and 82% satisfaction, while Kebbi has 150 towers and 31% satisfaction. Before recommending more towers for Kebbi, what should you examine first?' },
                { id: 2, category: 'Data Analysis', skill: 'Excel Pivot Table Analysis', question: 'You have 50,000 consumer complaint records in Excel. You need to find which service type has the highest complaint resolution rate by region. Which Excel feature and approach is most efficient?' },
                { id: 3, category: 'Data Analysis', skill: 'Statistical vs Practical Significance', question: 'A consumer education campaign improved complaint resolution knowledge from 62% to 64% in a survey of 45,000 consumers. The result is statistically significant (p<0.001). What is the most accurate interpretation?' },
                { id: 4, category: 'Data Analysis', skill: 'Self-Selection Bias Recognition', question: 'Your data shows consumers who use online complaint portals get 45% faster resolution times than those who call customer service. Before concluding that online portals are more efficient, what should you consider?' },
                { id: 5, category: 'Data Analysis', skill: 'Excel Data Analysis - Simpson\'s Paradox', question: 'Your Excel analysis shows Provider A resolves 75% of complaints vs Provider B at 78%. But examining by complaint type: billing issues (A: 85%, B: 82%) and service issues (A: 90%, B: 88%). Provider A performs better in both categories but worse overall. How do you explain this in your report?' },
                { id: 6, category: 'Data Analysis', skill: 'Measurement Error Impact', question: 'You\'re analyzing the relationship between household income and telecom service spending from consumer surveys. Many respondents understate their income to avoid appearing wealthy. How does this affect your analysis?' },
                { id: 7, category: 'Data Analysis', skill: 'Base Rate Understanding', question: 'Your fraud detection algorithm correctly identifies 92% of fraudulent telecom accounts and has 6% false alarms. In a market where only 0.3% of accounts are fraudulent, what percentage of flagged accounts are actually fraudulent?' },
                { id: 8, category: 'Data Analysis', skill: 'Regression to the Mean', question: 'After implementing a consumer protection intervention, you notice the worst-performing service providers improved significantly while top performers showed little change. Should the regulator focus all future interventions on poor performers?' },

                // M&E Questions (5)
                { id: 9, category: 'M&E', skill: 'Pre-test and Post-test Purpose', question: 'Why is it important to conduct pre-tests and post-tests when evaluating consumer education programs?' },
                { id: 10, category: 'M&E', skill: 'Output vs Outcome vs Impact', question: 'You evaluate a consumer awareness campaign about telecom billing rights. After 6 months: 85% can identify billing errors correctly, 68% now dispute incorrect charges, and overall billing complaints decreased 15%. How do you classify these results?' },
                { id: 11, category: 'M&E', skill: 'Complex Outcome Measurement', question: 'You need to measure whether consumer protection efforts have improved "consumer empowerment" in the telecom sector. Which indicator set best captures this complex outcome?' },
                { id: 12, category: 'M&E', skill: 'Monitoring vs Evaluation Distinction', question: 'What is the fundamental difference between monitoring and evaluation in consumer protection programs?' },
                { id: 13, category: 'M&E', skill: 'Logical Framework Design', question: 'Your logical framework for improving telecom service quality has this impact: "Enhanced consumer satisfaction with telecom services." The outcome is "Service providers improve response times." What is the most appropriate output indicator?' },

                // RCT/Impact Evaluation Questions (3)
                { id: 14, category: 'RCT/Impact', skill: 'Randomization Design Trade-offs', question: 'You want to test a new consumer complaint resolution process across 300 customer service centers in 50 cities. You could randomize individual centers or entire cities. What is the key trade-off?' },
                { id: 15, category: 'RCT/Impact', skill: 'Intent-to-Treat Analysis', question: 'In a consumer education RCT, 78% of assigned participants attended training, while 22% of the control group received similar training elsewhere. For policy decisions, which analysis approach is most valuable?' },
                { id: 16, category: 'RCT/Impact', skill: 'Research vs Implementation Effects', question: 'A consumer protection helpline RCT showed 85% issue resolution with intensive monitoring and support. When scaled nationally with normal operations, resolution dropped to 45%. This difference most likely reflects:' },

                // Programming Logic Questions (4) - Including actual programming skills
                { id: 17, category: 'Programming Logic', skill: 'Conditional Logic Programming', question: 'You\'re writing code to categorize consumer complaints by urgency. Complete this logic: if complaint_type == "billing" and amount > 10000: priority = "high" elif complaint_type == "service" and downtime > 24: priority = "high" else: priority = "normal". A service complaint with 30 hours downtime gets what priority?' },
                { id: 18, category: 'Programming Logic', skill: 'Boolean Logic and Operators', question: 'In a consumer protection database, you need to flag accounts where: (account_age < 6 months) AND (complaints != 0) AND NOT (resolved_complaints >= total_complaints). For an account with age=3, complaints=5, resolved=5, total=5, what does this expression evaluate to?' },
                { id: 19, category: 'Programming Logic', skill: 'System Reliability Design', question: 'A consumer complaint processing system must handle 15,000 daily complaints from multiple channels. Some data feeds fail or arrive late. Which approach ensures reliable daily reporting?' },
                { id: 20, category: 'Programming Logic', skill: 'Algorithm Optimization', question: 'A consumer complaint search system queries 8 million complaint records by phone number, taking 55 seconds per search. You could: add more servers, create a phone number index, cache frequent searches, or upgrade hardware. What provides the biggest performance improvement?' }
            ];

            const questionStats = questions.map(q => {
                let correct = 0;
                let total = 0;
                
                results.forEach(result => {
                    if (result[`Q${q.id}`] && result[`Q${q.id}_correct`]) {
                        total++;
                        if (result[`Q${q.id}`] === result[`Q${q.id}_correct`]) {
                            correct++;
                        }
                    }
                });
                
                return {
                    ...q,
                    correct,
                    total,
                    successRate: total > 0 ? Math.round((correct / total) * 100) : 0
                };
            }).filter(q => q.total > 0);

            const hardest = questionStats.sort((a, b) => a.successRate - b.successRate).slice(0, 5);
            const easiest = questionStats.sort((a, b) => b.successRate - a.successRate).slice(0, 5);

            updateQuestionAnalytics(hardest, easiest);
            generateSkillAnalytics(results);
        }

        function generateSkillAnalytics(results) {
            const skillAreaMapping = {
                'Data Analysis': {
                    questions: [1, 2, 3, 4, 5, 6, 7, 8],
                    description: 'Statistical thinking, Excel/Pivot tables, bias recognition, consumer data interpretation'
                },
                'M&E (Monitoring & Evaluation)': {
                    questions: [9, 10, 11, 12, 13],
                    description: 'Program evaluation, outcome measurement, consumer protection M&E frameworks'
                },
                'RCT/Impact Evaluation': {
                    questions: [14, 15, 16],
                    description: 'Randomized controlled trials, impact evaluation, research design for policy'
                },
                'Programming Logic': {
                    questions: [17, 18, 19, 20],
                    description: 'Programming syntax (if/else, boolean logic), system optimization, algorithm design'
                }
            };

            const skillAreaPerformance = {};
            Object.entries(skillAreaMapping).forEach(([area, config]) => {
                skillAreaPerformance[area] = {
                    name: area,
                    description: config.description,
                    totalQuestions: config.questions.length,
                    totalCorrect: 0,
                    totalPossible: 0,
                    participantScores: [],
                    averagePercentage: 0
                };
            });

            const participantAnalysis = results.map(participant => {
                const analysis = {
                    name: participant.participant_name,
                    id: participant.id,
                    totalScore: participant.total_score,
                    percentage: participant.percentage,
                    completedAt: participant.completed_at,
                    skillAreas: {}
                };

                Object.entries(skillAreaMapping).forEach(([area, config]) => {
                    analysis.skillAreas[area] = { 
                        correct: 0, 
                        total: config.questions.length, 
                        percentage: 0
                    };
                });

                Object.entries(skillAreaMapping).forEach(([area, config]) => {
                    let correct = 0;
                    config.questions.forEach(qNum => {
                        const userAnswer = participant[`Q${qNum}`];
                        const correctAnswer = participant[`Q${qNum}_correct`];
                        
                        skillAreaPerformance[area].totalPossible++;
                        
                        if (userAnswer === correctAnswer) {
                            correct++;
                            skillAreaPerformance[area].totalCorrect++;
                        }
                    });
                    
                    analysis.skillAreas[area].correct = correct;
                    analysis.skillAreas[area].percentage = Math.round((correct / config.questions.length) * 100);
                    skillAreaPerformance[area].participantScores.push(analysis.skillAreas[area].percentage);
                });

                return analysis;
            });

            Object.keys(skillAreaPerformance).forEach(area => {
                const areaData = skillAreaPerformance[area];
                if (areaData.participantScores.length > 0) {
                    areaData.averagePercentage = Math.round(
                        areaData.participantScores.reduce((sum, score) => sum + score, 0) / areaData.participantScores.length
                    );
                }
            });

            analyticsData = {
                skillAreas: Object.values(skillAreaPerformance),
                participantAnalysis
            };

            updateSkillAreas(analyticsData.skillAreas);
            updateParticipantAnalysis(analyticsData.participantAnalysis);
        }

        function updateQuestionAnalytics(hardest, easiest) {
            const hardestContainer = document.getElementById('hardestQuestions');
            const easiestContainer = document.getElementById('easiestQuestions');

            hardestContainer.innerHTML = hardest.map(q => `
                <li class="question-item hardest">
                    <div class="question-header">
                        <span class="question-number">Question ${q.id} - ${q.category}</span>
                        <span class="question-success-rate low">${q.successRate}%</span>
                    </div>
                    <div class="question-preview">${q.question.substring(0, 120)}...</div>
                </li>
            `).join('');

            easiestContainer.innerHTML = easiest.map(q => `
                <li class="question-item easiest">
                    <div class="question-header">
                        <span class="question-number">Question ${q.id} - ${q.category}</span>
                        <span class="question-success-rate high">${q.successRate}%</span>
                    </div>
                    <div class="question-preview">${q.question.substring(0, 120)}...</div>
                </li>
            `).join('');
        }

        function updateSkillAreas(skillAreas) {
            const container = document.getElementById('skillAreasChart');
            let html = '';
            
            skillAreas.forEach(area => {
                const color = area.averagePercentage >= 80 ? 'var(--primary-green)' : 
                             area.averagePercentage >= 60 ? '#f59e0b' : '#dc2626';
                const icon = area.name.includes('Data') ? 'chart-bar' : 
                           area.name.includes('M&E') ? 'tasks' :
                           area.name.includes('RCT') ? 'flask' : 'code';
                
                html += `
                    <div class="skill-item" style="margin-bottom: 24px; padding: 28px; border-left: 6px solid ${color}; background: var(--surface-alt);">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <h4 style="font-size: 1.2rem; margin-bottom: 8px; display: flex; align-items: center; gap: 12px;">
                                    <i class="fas fa-${icon}" style="color: ${color};"></i>
                                    ${area.name}
                                </h4>
                                <p style="color: var(--text-secondary); font-size: 1rem; margin-bottom: 8px; font-weight: 500;">${area.description}</p>
                                <span style="color: var(--text-muted); font-size: 0.875rem; font-weight: 500;">
                                    <i class="fas fa-users"></i> ${area.participantScores ? area.participantScores.length : 0} participants • 
                                    <i class="fas fa-question-circle"></i> ${area.totalQuestions} questions
                                </span>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-size: 2rem; font-weight: 800; color: ${color}; margin-bottom: 4px;">
                                    ${area.averagePercentage}%
                                </div>
                                <div style="font-size: 1rem; color: var(--text-secondary); font-weight: 600;">
                                    ${area.totalCorrect}/${area.totalPossible} correct
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function updateParticipantAnalysis(participants) {
            const container = document.getElementById('participantAnalysis');
            let sortedParticipants = [...participants];

            if (currentSort === 'highest') {
                sortedParticipants.sort((a, b) => b.percentage - a.percentage);
            } else if (currentSort === 'lowest') {
                sortedParticipants.sort((a, b) => a.percentage - b.percentage);
            } else {
                sortedParticipants.sort((a, b) => new Date(b.completedAt) - new Date(a.completedAt));
            }

            let html = '';
            
            sortedParticipants.forEach((participant, index) => {
                html += `
                    <div class="participant-card" onclick="toggleParticipantDetails(${index})">
                        <div class="participant-header">
                            <div class="participant-info">
                                <div class="participant-name">
                                    <i class="fas fa-user"></i> ${participant.name}
                                </div>
                                <div class="participant-date">
                                    <i class="fas fa-clock"></i> Completed: ${formatDateTime(participant.completedAt)}
                                </div>
                            </div>
                            <div class="participant-score">
                                <div class="score-badge ${getGradeClass(participant.percentage)}">
                                    ${participant.percentage}% (${participant.totalScore}/20)
                                </div>
                                <div class="expand-toggle">
                                    <span id="toggle-${index}">
                                        <i class="fas fa-chevron-down"></i> Click to expand
                                    </span>
                                </div>
                            </div>
                        </div>
                        <div class="participant-details" id="details-${index}">
                            <div class="skill-breakdown">
                `;
                
                Object.entries(participant.skillAreas).forEach(([area, data]) => {
                    const gradeClass = data.percentage >= 80 ? 'excellent' : 
                                      data.percentage >= 60 ? 'good' : 'needs-improvement';
                    
                    const icon = area.includes('Data') ? 'chart-bar' : 
                               area.includes('M&E') ? 'tasks' :
                               area.includes('RCT') ? 'flask' : 'code';
                    
                    html += `
                        <div class="skill-item">
                            <div class="skill-percentage ${gradeClass}">${data.percentage}%</div>
                            <div class="skill-name">
                                <i class="fas fa-${icon}"></i> ${area.replace('RCT/Impact', 'RCT')}
                            </div>
                            <div class="skill-score">${data.correct}/${data.total} correct</div>
                        </div>
                    `;
                });
                
                html += `
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function sortParticipants(sortType) {
            currentSort = sortType;
            if (analyticsData && analyticsData.participantAnalysis) {
                updateParticipantAnalysis(analyticsData.participantAnalysis);
            }
        }

        function toggleParticipantDetails(index) {
            const details = document.getElementById(`details-${index}`);
            const toggle = document.getElementById(`toggle-${index}`);
            
            if (details.classList.contains('expanded')) {
                details.classList.remove('expanded');
                toggle.innerHTML = '<i class="fas fa-chevron-down"></i> Click to expand';
            } else {
                document.querySelectorAll('.participant-details').forEach((detail, i) => {
                    if (i !== index && detail.classList.contains('expanded')) {
                        detail.classList.remove('expanded');
                        document.getElementById(`toggle-${i}`).innerHTML = '<i class="fas fa-chevron-down"></i> Click to expand';
                    }
                });
                
                details.classList.add('expanded');
                toggle.innerHTML = '<i class="fas fa-chevron-up"></i> Click to collapse';
            }
        }

        function updateStatistics(stats) {
            document.getElementById('totalParticipants').textContent = stats.total || 0;
            document.getElementById('averageScore').textContent = (stats.average_score || 0) + '%';
            document.getElementById('todayCount').textContent = stats.today_count || 0;
            document.getElementById('excellentCount').textContent = stats.excellent_count || 0;

            document.getElementById('sidebarTotal').textContent = stats.total || 0;
            document.getElementById('sidebarAverage').textContent = (stats.average_score || 0) + '%';
            document.getElementById('sidebarToday').textContent = stats.today_count || 0;

            const hasData = (stats.total || 0) > 0;
            document.getElementById('downloadBtn').disabled = !hasData;
            document.getElementById('downloadBtn2').disabled = !hasData;
        }

        function updateResultsTable(results) {
            const tbody = document.getElementById('resultsTableBody');
            tbody.innerHTML = '';

            results.forEach(result => {
                const categories = {
                    'Data Analysis': [1,2,3,4,5,6,7,8],
                    'M&E': [9,10,11,12,13],
                    'RCT/Impact': [14,15,16],
                    'Programming Logic': [17,18,19,20]
                };

                const scores = {};
                Object.entries(categories).forEach(([category, questions]) => {
                    let correct = 0;
                    questions.forEach(qNum => {
                        if (result[`Q${qNum}`] === result[`Q${qNum}_correct`]) {
                            correct++;
                        }
                    });
                    scores[category] = `${correct}/${questions.length}`;
                });

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><i class="fas fa-user" style="margin-right: 8px; color: var(--primary-green);"></i>${result.participant_name}</td>
                    <td>${result.total_score}/20</td>
                    <td>${result.percentage}%</td>
                    <td>${scores['Data Analysis']}</td>
                    <td>${scores['M&E']}</td>
                    <td>${scores['RCT/Impact']}</td>
                    <td>${scores['Programming Logic']}</td>
                    <td>
                        <span class="grade-badge ${getGradeClass(result.percentage)}">
                            ${getGradeText(result.percentage)}
                        </span>
                    </td>
                    <td>${formatDateTime(result.completed_at)}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function toggleSections() {
            const hasResults = quizResults.length > 0;
            document.getElementById('emptyState').classList.toggle('hidden', hasResults);
        }

        function getGradeClass(percentage) {
            if (percentage >= 80) return 'excellent';
            if (percentage >= 60) return 'good';
            return 'needs-improvement';
        }

        function getGradeText(percentage) {
            if (percentage >= 80) return 'Excellent';
            if (percentage >= 60) return 'Good';
            return 'Needs Improvement';
        }

        function formatDateTime(isoString) {
            return new Date(isoString).toLocaleString();
        }

        function showLoading() {
            document.getElementById('loadingState').classList.remove('hidden');
        }

        function hideLoading() {
            document.getElementById('loadingState').classList.add('hidden');
        }

        function showError(message) {
            document.getElementById('errorMessage').textContent = message;
            document.getElementById('errorState').classList.remove('hidden');
        }

        function hideError() {
            document.getElementById('errorState').classList.add('hidden');
        }

        function showActionMessage(message, isError = false) {
            const div = document.getElementById('actionMessage') || document.getElementById('actionMessage2');
            if (div) {
                div.textContent = message;
                div.className = isError ? 'error-state' : 'success-state';
                div.classList.remove('hidden');
                setTimeout(() => div.classList.add('hidden'), 5000);
            }
        }

        async function downloadCSV() {
            try {
                const response = await fetch('/api/download-csv');
                if (response.ok) {
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.style.display = 'none';
                    a.href = url;
                    a.download = `consumer_protection_assessment_results_${new Date().toISOString().split('T')[0]}.csv`;
                    document.body.appendChild(a);
                    a.click();
                    window.URL.revokeObjectURL(url);
                    showActionMessage('CSV downloaded successfully!');
                } else {
                    throw new Error('Failed to download CSV');
                }
            } catch (error) {
                console.error('Error downloading CSV:', error);
                showActionMessage('Failed to download CSV: ' + error.message, true);
            }
        }

        async function checkHealth() {
            try {
                const response = await fetch('/api/health');
                if (response.ok) {
                    const result = await response.json();
                    showActionMessage(result.message);
                } else {
                    throw new Error('Health check failed');
                }
            } catch (error) {
                console.error('Health check failed:', error);
                showActionMessage('Health check failed: ' + error.message, true);
            }
        }

       async function clearAllData() {
    if (quizResults.length === 0) {
        showActionMessage('No data to clear.', true);
        return;
    }

    // First confirmation
    const confirmed = confirm(`⚠️ DANGER ZONE ⚠️\n\nAre you sure you want to delete all ${quizResults.length} assessment results?\n\nThis action cannot be undone and will permanently remove all participant data.`);
    
    if (!confirmed) {
        return; // User cancelled
    }

    // Second confirmation for extra safety
    const doubleConfirmed = confirm(`This is your final warning!\n\nYou are about to delete ${quizResults.length} assessment results permanently.\n\nType YES in the next dialog to confirm.`);
    
    if (!doubleConfirmed) {
        return; // User cancelled second confirmation
    }

    // Third confirmation requiring text input
    const finalConfirmation = prompt(`To confirm deletion, type "DELETE ALL DATA" exactly (without quotes):`);
    
    if (finalConfirmation !== "DELETE ALL DATA") {
        showActionMessage('Deletion cancelled - confirmation text did not match.', true);
        return;
    }

    try {
        const response = await fetch('/api/results', {
            method: 'DELETE'
        });
        
        if (response.ok) {
            const result = await response.json();
            showActionMessage(result.message);
            await refreshData();
        } else {
            throw new Error('Failed to clear data');
        }
    } catch (error) {
        console.error('Error clearing data:', error);
        showActionMessage('Failed to clear data: ' + error.message, true);
    }
}



        document.getElementById('adminPassword').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') login();
        });

        window.addEventListener('load', () => {
            console.log('Consumer Protection Assessment admin dashboard loaded');
        });
    </script>
</body>
</html>